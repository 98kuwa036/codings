<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¥å‡ºåº«è¨˜éŒ² CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç®¡ç†</title>

  <style>
    /* --- å¤‰æ•°å®šç¾© (Tailwindã®è‰²å‘³ã‚’å†ç¾) --- */
    :root {
      --bg-gray-50: #f9fafb;
      --bg-gray-100: #f3f4f6;
      --bg-white: #ffffff;
      --text-gray-800: #1f2937;
      --text-gray-600: #4b5563;
      --text-gray-500: #6b7280;
      --text-gray-400: #9ca3af;
      --bg-blue-600: #2563eb;
      --bg-blue-700: #1d4ed8;
      --bg-green-600: #16a34a;
      --bg-green-700: #15803d;
      --bg-yellow-50: #fefce8;
      --bg-yellow-600: #ca8a04;
      --bg-red-600: #dc2626;
      --bg-red-700: #b91c1c;
      --border-gray-300: #d1d5db;
      --border-blue-300: #93c5fd;
      --focus-ring-blue: rgba(59, 130, 246, 0.5);
    }

    /* --- åŸºæœ¬ãƒªã‚»ãƒƒãƒˆ --- */
    body {
      margin: 0;
      font-family: "Helvetica Neue", Arial, "Hiragino Sans", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background-color: var(--bg-gray-50);
      color: var(--text-gray-800);
      padding: 1.5rem;
    }
    *, *::before, *::after { box-sizing: border-box; }

    /* --- ã‚³ãƒ³ãƒ†ãƒŠ --- */
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* --- ã‚«ãƒ¼ãƒ‰ --- */
    .card {
      background-color: var(--bg-white);
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      margin-bottom: 1.5rem;
    }

    /* --- ã‚¿ã‚¤ãƒˆãƒ« --- */
    h1 {
      font-size: 1.875rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      color: var(--text-gray-800);
    }
    h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0 0 1rem 0;
      color: var(--text-gray-800);
    }
    h3 {
      font-size: 1rem;
      font-weight: 600;
      margin: 0 0 0.75rem 0;
      color: var(--text-gray-600);
    }
    p.subtitle {
      color: var(--text-gray-600);
      margin: 0 0 1.5rem 0;
    }

    /* --- ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  --- */
    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-gray-600);
      margin-bottom: 0.5rem;
    }

    input[type="number"], select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-gray-300);
      border-radius: 0.375rem;
      font-size: 1rem;
      outline: none;
    }
    input[type="number"]:focus, select:focus {
      border-color: var(--bg-blue-600);
      box-shadow: 0 0 0 3px var(--focus-ring-blue);
    }

    /* --- ãƒœã‚¿ãƒ³ --- */
    .btn {
      padding: 0.625rem 1rem;
      font-weight: 600;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background-color 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-primary {
      background-color: var(--bg-blue-600);
      color: white;
    }
    .btn-primary:hover:not(:disabled) {
      background-color: var(--bg-blue-700);
    }
    .btn-success {
      background-color: var(--bg-green-600);
      color: white;
    }
    .btn-success:hover:not(:disabled) {
      background-color: var(--bg-green-700);
    }
    .btn-warning {
      background-color: var(--bg-yellow-600);
      color: white;
    }
    .btn-danger {
      background-color: var(--bg-red-600);
      color: white;
    }
    .btn-danger:hover:not(:disabled) {
      background-color: var(--bg-red-700);
    }
    .btn-secondary {
      background-color: var(--text-gray-500);
      color: white;
    }

    /* --- ã‚°ãƒªãƒƒãƒ‰ --- */
    .grid {
      display: grid;
      gap: 1rem;
    }
    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .grid-cols-3 {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 768px) {
      .grid-cols-2, .grid-cols-3 {
        grid-template-columns: 1fr;
      }
    }

    /* --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º --- */
    .status-box {
      padding: 1rem;
      border-radius: 0.375rem;
      border-left: 4px solid;
      margin-bottom: 1rem;
    }
    .status-info {
      background-color: #eff6ff;
      border-color: var(--bg-blue-600);
      color: #1e40af;
    }
    .status-success {
      background-color: #f0fdf4;
      border-color: var(--bg-green-600);
      color: #166534;
    }
    .status-warning {
      background-color: var(--bg-yellow-50);
      border-color: var(--bg-yellow-600);
      color: #854d0e;
    }

    /* --- ãƒ†ãƒ¼ãƒ–ãƒ« --- */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }
    th {
      background-color: var(--bg-gray-100);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid var(--border-gray-300);
    }
    td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-gray-300);
    }
    tr:last-child td {
      border-bottom: none;
    }

    /* --- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ --- */
    .spinner {
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      display: inline-block;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* --- ãƒ­ã‚°ã‚¨ãƒªã‚¢ --- */
    #log-area {
      background-color: #1f2937;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 0.375rem;
      font-family: "Consolas", "Monaco", monospace;
      font-size: 0.75rem;
      line-height: 1.5;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* --- ãƒ˜ãƒ«ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- */
    .help-section {
      background-color: #eff6ff;
      border: 1px solid var(--border-blue-300);
      border-radius: 0.375rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .help-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      margin-bottom: 0.75rem;
    }
    .help-icon {
      width: 1.25rem;
      height: 1.25rem;
      transition: transform 0.2s;
    }

    /* --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ --- */
    .hidden { display: none; }
    .mt-4 { margin-top: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .text-sm { font-size: 0.875rem; }
    .text-xs { font-size: 0.75rem; }
    .font-semibold { font-weight: 600; }
    .text-gray-600 { color: var(--text-gray-600); }
    .text-blue-600 { color: var(--bg-blue-600); }
  </style>
</head>
<body>

  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="card">
      <h1>ğŸ“Š å…¥å‡ºåº«è¨˜éŒ² CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç®¡ç†</h1>
      <p class="subtitle">å·®åˆ†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã§ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ã‚’é˜²ãã¾ã™</p>

      <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
      <div class="help-section">
        <div class="help-title" onclick="toggleHelp()">
          <span style="font-weight: 600; color: #1d4ed8; font-size: 0.875rem;">
            ğŸ’¡ ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰
          </span>
          <svg id="help-toggle-icon" class="help-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="#1d4ed8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </div>
        <div id="help-content" style="display: none; font-size: 0.875rem; color: #374151; line-height: 1.6;">
          <p style="margin: 0 0 0.5rem 0;"><strong>å·®åˆ†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¤ã„ã¦</strong></p>
          <p style="margin: 0 0 0.75rem 0;">å‰å›ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä»¥é™ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã€åŒã˜æœˆã«è¤‡æ•°å›å®Ÿè¡Œã—ã¦ã‚‚é‡è¤‡ã—ã¾ã›ã‚“ã€‚</p>

          <p style="margin: 0 0 0.5rem 0;"><strong>åŸºæœ¬çš„ãªä½¿ã„æ–¹</strong></p>
          <ol style="margin: 0 0 0.75rem 0; padding-left: 1.5rem;">
            <li>ã€ŒCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å¹´æœˆã‚’é¸æŠ</li>
            <li>ã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>å®Œäº†å¾Œã€ç”Ÿæˆã•ã‚ŒãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
            <li>Excel VBAã§é †ç•ªã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</li>
          </ol>

          <p style="margin: 0 0 0.5rem 0;"><strong>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ç®¡ç†</strong></p>
          <p style="margin: 0 0 0.5rem 0;">ãƒ»ã€Œå±¥æ­´ã‚’ç¢ºèªã€ï¼šéå»ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚ã‚’ç¢ºèª<br>
          ãƒ»ã€Œå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã€ï¼šæœˆåˆã‹ã‚‰å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸã„å ´åˆã«ä½¿ç”¨</p>
        </div>
      </div>
    </div>

    <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´çŠ¶æ…‹ -->
    <div class="card">
      <h2>ğŸ“‹ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´çŠ¶æ…‹</h2>
      <div id="history-status" class="status-box status-info">
        <p style="margin: 0;">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
      <button class="btn btn-secondary" onclick="loadHistory()">ğŸ”„ å±¥æ­´ã‚’ç¢ºèª</button>
    </div>

    <!-- CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
    <div class="card">
      <h2>ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
      <form id="export-form">
        <div class="grid grid-cols-3">
          <div>
            <label for="export-year">å¯¾è±¡å¹´</label>
            <input type="number" id="export-year" min="2020" max="2099" required>
          </div>
          <div>
            <label for="export-month">å¯¾è±¡æœˆ</label>
            <select id="export-month" required>
              <option value="1">1æœˆ</option>
              <option value="2">2æœˆ</option>
              <option value="3">3æœˆ</option>
              <option value="4">4æœˆ</option>
              <option value="5">5æœˆ</option>
              <option value="6">6æœˆ</option>
              <option value="7">7æœˆ</option>
              <option value="8">8æœˆ</option>
              <option value="9">9æœˆ</option>
              <option value="10">10æœˆ</option>
              <option value="11">11æœˆ</option>
              <option value="12">12æœˆ</option>
            </select>
          </div>
          <div style="display: flex; align-items: flex-end;">
            <button type="submit" class="btn btn-primary" style="width: 100%;">
              <span id="export-btn-text">â–¶ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ</span>
              <span id="export-spinner" class="spinner hidden"></span>
            </button>
          </div>
        </div>
      </form>
      <div id="export-result" class="mt-4"></div>
    </div>

    <!-- å±¥æ­´ç®¡ç† -->
    <div class="card">
      <h2>ğŸ—‚ï¸ å±¥æ­´ç®¡ç†</h2>
      <div class="grid grid-cols-2">
        <div>
          <h3>ç‰¹å®šæœˆã‚’ãƒªã‚»ãƒƒãƒˆ</h3>
          <div class="grid grid-cols-3">
            <input type="number" id="reset-year" min="2020" max="2099" placeholder="å¹´">
            <input type="number" id="reset-month" min="1" max="12" placeholder="æœˆ">
            <button class="btn btn-warning" onclick="resetMonth()">âš ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
        </div>
        <div>
          <h3>ç‰¹å®šå¹´ã®å…¨æœˆã‚’ãƒªã‚»ãƒƒãƒˆ</h3>
          <div class="grid grid-cols-2">
            <input type="number" id="reset-year-all" min="2020" max="2099" placeholder="å¹´">
            <button class="btn btn-danger" onclick="resetYear()">ğŸ—‘ï¸ å…¨ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <div class="card">
      <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
      <div id="log-area"># ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
      <button class="btn btn-secondary mt-4" onclick="clearLog()">ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
  </div>

  <script>
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // ç¾åœ¨ã®å¹´æœˆã‚’è¨­å®š
      const now = new Date();
      document.getElementById('export-year').value = now.getFullYear();
      document.getElementById('export-month').value = now.getMonth() + 1;

      // å±¥æ­´ã‚’èª­ã¿è¾¼ã¿
      loadHistory();

      log('âœ… ç®¡ç†ç”»é¢ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
    });

    // ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤ºåˆ‡æ›¿
    function toggleHelp() {
      const content = document.getElementById('help-content');
      const icon = document.getElementById('help-toggle-icon');
      const isHidden = content.style.display === 'none';
      content.style.display = isHidden ? 'block' : 'none';
      icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    document.getElementById('export-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const year = parseInt(document.getElementById('export-year').value);
      const month = parseInt(document.getElementById('export-month').value);

      const btnText = document.getElementById('export-btn-text');
      const spinner = document.getElementById('export-spinner');
      const resultDiv = document.getElementById('export-result');

      btnText.textContent = 'å‡¦ç†ä¸­...';
      spinner.classList.remove('hidden');
      resultDiv.innerHTML = '';

      log(`ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–‹å§‹: ${year}å¹´${month}æœˆ`);

      try {
        const result = await google.script.run
          .withSuccessHandler(onExportSuccess)
          .withFailureHandler(onExportFailure)
          .exportCSV(year, month);
      } catch (error) {
        onExportFailure(error);
      } finally {
        btnText.textContent = 'â–¶ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Ÿè¡Œ';
        spinner.classList.add('hidden');
      }
    });

    function onExportSuccess(result) {
      const resultDiv = document.getElementById('export-result');
      resultDiv.innerHTML = `
        <div class="status-box status-success">
          <p style="margin: 0 0 0.5rem 0; font-weight: 600;">âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæˆåŠŸ</p>
          <p style="margin: 0; font-size: 0.875rem;">
            ãƒ•ã‚¡ã‚¤ãƒ«å: ${result.fileName}<br>
            ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä»¶æ•°: ${result.count}ä»¶<br>
            <a href="${result.fileUrl}" target="_blank" style="color: #166534; text-decoration: underline;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã</a>
          </p>
        </div>
      `;
      log(`âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæˆåŠŸ: ${result.count}ä»¶`);
      log(`ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«: ${result.fileName}`);
      loadHistory(); // å±¥æ­´ã‚’å†èª­ã¿è¾¼ã¿
    }

    function onExportFailure(error) {
      const resultDiv = document.getElementById('export-result');
      resultDiv.innerHTML = `
        <div class="status-box" style="background-color: #fee; border-color: #dc2626; color: #991b1b;">
          <p style="margin: 0; font-weight: 600;">âŒ ã‚¨ãƒ©ãƒ¼</p>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;">${error.message || error}</p>
        </div>
      `;
      log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message || error}`);
    }

    // å±¥æ­´èª­ã¿è¾¼ã¿
    function loadHistory() {
      log('ğŸ” ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ã‚’ç¢ºèªä¸­...');
      google.script.run
        .withSuccessHandler(displayHistory)
        .withFailureHandler((error) => {
          log(`âŒ å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        })
        .getAllExportHistory();
    }

    function displayHistory(history) {
      const statusDiv = document.getElementById('history-status');

      if (!history || history.length === 0) {
        statusDiv.className = 'status-box status-warning';
        statusDiv.innerHTML = '<p style="margin: 0;">âš ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        log('ğŸ“‹ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´: ãªã—');
        return;
      }

      statusDiv.className = 'status-box status-success';
      let html = '<p style="margin: 0 0 0.75rem 0; font-weight: 600;">âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ (${history.length}ä»¶)</p>';
      html += '<table><thead><tr><th>å¹´æœˆ</th><th>æœ€çµ‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚</th></tr></thead><tbody>';

      history.forEach(item => {
        html += `<tr><td>${item.yearMonth}</td><td>${item.dateTime}</td></tr>`;
      });

      html += '</tbody></table>';
      statusDiv.innerHTML = html;
      log(`ğŸ“‹ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ã‚’è¡¨ç¤º: ${history.length}ä»¶`);
    }

    // æœˆãƒªã‚»ãƒƒãƒˆ
    function resetMonth() {
      const year = parseInt(document.getElementById('reset-year').value);
      const month = parseInt(document.getElementById('reset-month').value);

      if (!year || !month) {
        alert('å¹´ã¨æœˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      if (!confirm(`${year}å¹´${month}æœˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\næ¬¡å›ã¯æœˆåˆã‹ã‚‰ã®å…¨ãƒ‡ãƒ¼ã‚¿ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚`)) {
        return;
      }

      log(`âš ï¸ å±¥æ­´ãƒªã‚»ãƒƒãƒˆé–‹å§‹: ${year}å¹´${month}æœˆ`);

      google.script.run
        .withSuccessHandler(() => {
          log(`âœ… å±¥æ­´ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${year}å¹´${month}æœˆ`);
          loadHistory();
        })
        .withFailureHandler((error) => {
          log(`âŒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
        })
        .resetExportHistory(year, month);
    }

    // å¹´ãƒªã‚»ãƒƒãƒˆ
    function resetYear() {
      const year = parseInt(document.getElementById('reset-year-all').value);

      if (!year) {
        alert('å¹´ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      if (!confirm(`${year}å¹´ã®å…¨æœˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
        return;
      }

      log(`âš ï¸ å¹´é–“å±¥æ­´ãƒªã‚»ãƒƒãƒˆé–‹å§‹: ${year}å¹´`);

      google.script.run
        .withSuccessHandler(() => {
          log(`âœ… å¹´é–“å±¥æ­´ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${year}å¹´`);
          loadHistory();
        })
        .withFailureHandler((error) => {
          log(`âŒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
        })
        .resetYearExportHistory(year);
    }

    // ãƒ­ã‚°å‡ºåŠ›
    function log(message) {
      const logArea = document.getElementById('log-area');
      const timestamp = new Date().toLocaleString('ja-JP', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      logArea.textContent += `[${timestamp}] ${message}\n`;
      logArea.scrollTop = logArea.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log-area').textContent = '# ãƒ­ã‚°ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ\n';
      log('ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
    }
  </script>

</body>
</html>
