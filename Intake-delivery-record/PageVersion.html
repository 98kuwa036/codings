<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¥å‡ºåº«è¨˜éŒ²ãƒ„ãƒ¼ãƒ«</title>

    <style>
        /* --- åŸºæœ¬ãƒªã‚»ãƒƒãƒˆ & å¤‰æ•° --- */
        :root {
            --bg-gray-50: #f9fafb;
            --bg-gray-100: #f3f4f6;
            --bg-gray-200: #e5e7eb;
            --bg-gray-300: #d1d5db;
            --bg-blue-50: #eff6ff;
            --bg-blue-500: #3b82f6;
            --bg-blue-600: #2563eb;
            --bg-blue-700: #1d4ed8;
            --bg-green-500: #22c55e;
            --bg-green-600: #16a34a;
            --bg-green-700: #15803d;
            --bg-gray-500: #6b7280;
            --bg-gray-600: #4b5563;
            --text-gray-400: #9ca3af;
            --text-gray-500: #6b7280;
            --text-gray-600: #4b5563;
            --text-gray-700: #374151;
            --text-gray-800: #1f2937;
            --text-blue-600: #2563eb;
            --text-blue-700: #1d4ed8;
            --border-gray-200: #e5e7eb;
            --border-gray-300: #d1d5db;
            --border-blue-300: #93c5fd;
        }

        body {
            margin: 0;
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-gray-50);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 3rem 1rem;
            box-sizing: border-box;
            color: var(--text-gray-800);
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }
        
        /* â˜…ä¿®æ­£1: fieldsetã®æ ç·šã‚’æ¶ˆã™ */
        fieldset {
            border: none;
            padding: 0;
            margin: 0;
            min-width: 0;
        }

        /* --- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ --- */
        .w-full { width: 100%; }
        .max-w-lg { max-width: 32rem; }
        .max-w-xs { max-width: 20rem; }
        .h-full { height: 100%; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .mr-1\.5 { margin-right: 0.375rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-8 { padding: 2rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-10 { padding-top: 2.5rem; padding-bottom: 2.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }

        /* --- Flex & Grid --- */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .flex-grow { flex-grow: 1; }
        .flex-1 { flex: 1 1 0%; }
        .flex-auto { flex: 1 1 auto; }
        .gap-x-2 { column-gap: 0.5rem; }
        .gap-x-4 { column-gap: 1rem; }
        .gap-4 { gap: 1rem; }
        
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)); }
        .col-span-2 { grid-column: span 2 / span 2; }
        .col-span-5 { grid-column: span 5 / span 5; }

        @media (min-width: 768px) {
            .md\:grid-cols-3, .md-grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:col-span-2, .md-col-span-2 { grid-column: span 2 / span 2; }
        }

        /* --- ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚° --- */
        .space-y-2 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.5rem; }
        .space-y-3 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.75rem; }
        .space-y-4 > :not([hidden]) ~ :not([hidden]) { margin-top: 1rem; }
        .space-y-5 > :not([hidden]) ~ :not([hidden]) { margin-top: 1.25rem; }
        .space-y-6 > :not([hidden]) ~ :not([hidden]) { margin-top: 1.5rem; }

        /* --- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ« --- */
        .bg-white { background-color: white; }
        .bg-gray-50 { background-color: var(--bg-gray-50); }
        .bg-blue-50 { background-color: var(--bg-blue-50); }
        
        .rounded-md { border-radius: 0.375rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-full { border-radius: 9999px; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }

        .border { border-width: 1px; border-style: solid; }
        .border-t-2 { border-top-width: 2px; border-style: solid; }
        .border-b { border-bottom-width: 1px; border-style: solid; }
        .border-gray-200 { border-color: var(--border-gray-200); }
        .border-gray-300 { border-color: var(--border-gray-300); }
        .border-blue-300 { border-color: var(--border-blue-300); }

        /* ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£ */
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-md { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ */
        /* â˜…ä¿®æ­£2: æ–‡å­—è‰²ã®å„ªå…ˆåº¦ã‚’ä¸Šã’ã‚‹ (!important) */
        .text-white { color: white !important; } 
        .text-gray-400 { color: var(--text-gray-400); }
        .text-gray-500 { color: var(--text-gray-500); }
        .text-gray-600 { color: var(--text-gray-600); }
        .text-gray-700 { color: var(--text-gray-700); }
        .text-gray-800 { color: var(--text-gray-800); }
        .text-blue-600 { color: var(--text-blue-600); }
        .text-blue-700 { color: var(--text-blue-700); }
        .text-green-500 { color: var(--bg-green-500); }

        /* --- ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  --- */
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            display: block;
            width: 100%;
            border: 1px solid var(--border-gray-300);
            border-radius: 0.375rem;
            padding: 0.75rem 1rem;
            font-size: 1.125rem;
            background-color: white;
            appearance: none; /* ãƒ–ãƒ©ã‚¦ã‚¶ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ¶ˆã™ */
        }
        input:disabled {
            background-color: var(--bg-gray-200);
            cursor: not-allowed;
        }

        /* --- ãƒœã‚¿ãƒ³ & å‹•çš„ã‚«ãƒ©ãƒ¼ --- */
        button {
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .bg-gray-100 { background-color: var(--bg-gray-100); }
        .bg-gray-200 { background-color: var(--bg-gray-200); }
        .bg-gray-300 { background-color: var(--bg-gray-300); }
        
        .bg-blue-500 { background-color: var(--bg-blue-500); }
        .bg-blue-600 { background-color: var(--bg-blue-600); }
        .bg-blue-600:hover:not(:disabled) { background-color: var(--bg-blue-700); }
        
        .bg-green-500 { background-color: var(--bg-green-500); }
        .bg-green-600 { background-color: var(--bg-green-600); }
        .bg-green-600:hover:not(:disabled) { background-color: var(--bg-green-700); }

        .bg-gray-500 { background-color: var(--bg-gray-500); }
        .bg-gray-500:hover:not(:disabled) { background-color: var(--bg-gray-600); }

        /* --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ --- */
        .hidden { display: none !important; }
        .block { display: block; }
        .opacity-0 { opacity: 0; }
        .opacity-50 { opacity: 0.5; }
        .transition-opacity { transition: opacity 0.3s ease-in-out; }
        .duration-300 { transition-duration: 300ms; }
        .duration-500 { transition-duration: 500ms; }
        .ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }

        /* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* --- ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º --- */
        .w-5 { width: 1.25rem; }
        .h-5 { height: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .h-6 { height: 1.5rem; }
        .w-8 { width: 2rem; }
        .h-8 { height: 2rem; }
        .w-16 { width: 4rem; }
        .h-16 { height: 4rem; }
        .w-20 { width: 5rem; }
        .h-20 { height: 5rem; }
        
        .w-3\/4 { width: 75%; }
        .w-1\/4 { width: 25%; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-8 { height: 2rem; }
        .h-10 { height: 2.5rem; }

        /* --- è¨€èªåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ --- */
        .lang-switcher {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.125rem;
            background-color: var(--bg-gray-100);
            border-radius: 0.375rem;
            padding: 0.125rem;
        }
        .lang-btn {
            padding: 0.25rem 0.375rem;
            font-size: 1.25rem;
            line-height: 1;
            background-color: transparent;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            opacity: 0.5;
        }
        .lang-btn:hover {
            opacity: 0.8;
        }
        .lang-btn.active {
            background-color: white;
            opacity: 1;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen py-12">
  <div class="w-full max-w-lg p-8 space-y-6 bg-white rounded-xl shadow-lg" style="position: relative;">

    <!-- è¨€èªåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ -->
    <div class="lang-switcher">
      <button class="lang-btn active" data-lang="ja" onclick="switchLanguage('ja')" title="æ—¥æœ¬èª">ğŸ‡¯ğŸ‡µ</button>
      <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')" title="English">ğŸ‡¬ğŸ‡§</button>
      <button class="lang-btn" data-lang="id" onclick="switchLanguage('id')" title="Indonesia">ğŸ‡®ğŸ‡©</button>
    </div>
    
    <div id="status-message" class="space-y-6 py-4 animate-pulse transition-opacity duration-300 ease-in-out">
      <div class="h-8 bg-gray-300 rounded-md w-3/4 mx-auto"></div>
      <div class="flex items-center w-full mx-auto mt-6">
        <div class="flex flex-col items-center">
          <div class="w-8 h-8 rounded-full bg-gray-300"></div>
          <div class="h-4 bg-gray-300 rounded-md w-16 mt-1"></div>
        </div>
        <div class="flex-auto border-t-2 border-gray-200 mx-2"></div>
        <div class="flex flex-col items-center">
          <div class="w-8 h-8 rounded-full bg-gray-300"></div>
          <div class="h-4 bg-gray-300 rounded-md w-16 mt-1"></div>
        </div>
        <div class="flex-auto border-t-2 border-gray-200 mx-2"></div>
        <div class="flex flex-col items-center">
          <div class="w-8 h-8 rounded-full bg-gray-300"></div>
          <div class="h-4 bg-gray-300 rounded-md w-16 mt-1"></div>
        </div>
      </div>
      <div class="space-y-5 mt-8">
        <div>
          <div class="h-5 bg-gray-300 rounded-md w-1/4 mb-2"></div>
          <div class="h-10 bg-gray-300 rounded-md w-full"></div>
        </div>
        <div>
          <div class="h-5 bg-gray-300 rounded-md w-1/4 mb-2"></div>
          <div class="h-10 bg-gray-300 rounded-md w-full"></div>
        </div>
      </div>
      <div class="pt-4 text-center">
        <p id="loading-status-text" class="text-sm font-medium text-gray-500">
          ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...
        </p>
      </div>
    </div>
        
    <div id="main-content" style="display: none;" class="opacity-0 transition-opacity duration-500 ease-in-out">
      <h1 id="main-title" class="text-2xl font-bold text-center text-gray-800">å‡ºåº«ç™»éŒ²ãƒ„ãƒ¼ãƒ«</h1>
            
      <div id="progress-bar" class="flex items-center w-full mx-auto mt-6">
          <div class="flex flex-col items-center text-blue-600">
              <div id="step1-circle" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">1</div>
              <p class="text-sm font-semibold mt-1">æƒ…å ±å…¥åŠ›</p>
          </div>
          <div id="progress-line1" class="flex-auto border-t-2 border-gray-300 transition-colors duration-500 mx-2"></div>
          <div class="flex flex-col items-center text-gray-400">
              <div id="step2-circle" class="w-8 h-8 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center font-bold">2</div>
              <p class="text-sm font-semibold mt-1">å“ç›®ç™»éŒ²</p>
          </div>
          <div id="progress-line2" class="flex-auto border-t-2 border-gray-300 transition-colors duration-500 mx-2"></div>
          <div class="flex flex-col items-center text-gray-400">
              <div id="step3-circle" class="w-8 h-8 rounded-full bg-gray-300 text-gray-500 flex items-center justify-center font-bold">3</div>
              <p class="text-sm font-semibold mt-1">å†…å®¹ç¢ºèª</p>
          </div>
      </div>
            
      <div id="register-progress-info" class="hidden flex items-center justify-center w-full mx-auto mt-6 h-[68px] bg-gray-50 rounded-md border border-gray-200">
        <p class="text-sm font-semibold text-gray-600 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
          </svg>
          æ–°è¦ç‰©å“ ä»®ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
        </p>
      </div>
            
      <div id="page1">
          <fieldset id="page1-fieldset">
              <div style="margin-top: 0.5rem;">
                  <div id="registrant-section">
                      <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">æ‹…å½“è€…å</label>
                      <div style="display: flex; align-items: center; gap: 0.5rem;">
                          <div id="registrant-display-container" style="flex-grow: 1; display: flex; align-items: center;">
                              <p id="registrant-display" style="font-size: 1.125rem; padding: 0.75rem 1rem; background-color: #f3f4f6; border-radius: 0.375rem; width: 100%; margin: 0;">ï¼ˆèª­ã¿è¾¼ã¿ä¸­...ï¼‰</p>
                          </div>
                          <select id="registrant-select" style="flex-grow: 1; display: none;"></select>
                          <input type="hidden" id="registrant-name" value="">
                          <button type="button" id="change-user-btn" style="display: none; padding: 0.75rem 1rem; background-color: #6b7280; color: white; font-weight: 600; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">å¤‰æ›´</button>
                      </div>
                      <div id="admin-link-placeholder" style="margin: 0.5rem 0; font-size: 0.875rem;"></div>
                  </div>
                  <div id="date-section" style="margin-top: 1rem;">
                      <label for="date-input" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">æ—¥ä»˜</label>
                      <input type="date" id="date-input" style="width: 100%;" required>
                  </div>
              </div>

              <div style="display: grid; grid-template-columns: 5fr 2fr; gap: 1rem; margin-top: 2rem;">
                  <button id="next-btn" style="width: 100%; padding: 0.75rem 1rem; background-color: #2563eb; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;" disabled>æ¬¡ã¸é€²ã‚€</button>
                  <button id="toggle-mode-button" type="button" style="width: 100%; padding: 0.75rem 1rem; background-color: #6b7280; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">å…¥åº«</button>
              </div>
          </fieldset>
      </div>
      
      <div id="page2" style="display: none;">
          <div style="margin-top: 2rem;">
              <fieldset id="inbound-fields" style="display: none; border: 1px solid #93c5fd; background-color: #eff6ff; padding: 1rem; border-radius: 0.375rem; margin-bottom: 1rem;">
                  <legend style="font-size: 1.125rem; font-weight: 600; padding: 0 0.5rem; color: #1d4ed8;">å…¥åº«æƒ…å ±</legend>
                  <div>
                      <div id="photo-upload-section">
                          <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">ä¼ç¥¨å†™çœŸ (ä»»æ„)</label>
                          <div style="display: flex; gap: 0.5rem;">
                              <button type="button" id="select-file-btn" style="flex: 1; padding: 0.5rem 1rem; background-color: white; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; color: #374151; cursor: pointer;">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
                              <button type="button" id="launch-camera-btn" style="display: none; flex: 1; padding: 0.5rem 1rem; background-color: #3b82f6; color: white; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; border: none; cursor: pointer;">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•</button>
                          </div>
                          <p id="file-name-display" style="font-size: 0.875rem; color: #4b5563; margin-top: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></p>
                          <input type="file" id="voucher-photo-file" style="display: none;" accept="image/*">
                          <input type="file" id="voucher-photo-camera" style="display: none;" accept="image/*" capture="environment">
                      </div>
                      <div id="voucher-number-input-group" style="margin-top: 1rem;">
                          <label for="voucher-number" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">ä¼ç¥¨ç•ªå· (å†™çœŸé¸æŠå¾Œã«æœ‰åŠ¹åŒ–)</label>
                          <input type="text" id="voucher-number" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«åã«ãªã‚Šã¾ã™" style="width: 100%;" disabled>
                      </div>
                  </div>
              </fieldset>
              <fieldset id="item-add-section" style="border: 1px solid #d1d5db; padding: 1rem; border-radius: 0.375rem;">
                  <legend id="item-section-legend" style="font-size: 1.125rem; font-weight: 600; padding: 0 0.5rem; color: #374151;">å‡ºåº«å“ç›®</legend>
                  <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                      <div>
                          <label for="item-name" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">å“å</label>
                          <input type="text" id="item-search" placeholder="å“åã‚’æ¤œç´¢..." style="width: 100%; margin-bottom: 0.5rem; padding: 0.5rem 0.75rem; font-size: 0.875rem;">
                          <select id="item-name" style="width: 100%;">
                              <option value="" disabled selected>-- å“åã‚’é¸æŠ --</option>
                          </select>
                      </div>
                      <div>
                          <label for="quantity" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">å€‹æ•°</label>
                          <input type="number" id="quantity" placeholder="å€‹æ•°" style="width: 100%;">
                      </div>
                  </div>
                  <button id="add-item-button" type="button" style="width: 100%; margin-top: 1rem; padding: 0.75rem 1rem; background-color: #22c55e; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;" disabled>å“ç›®ã‚’è¿½åŠ </button>
              </fieldset>
              <div id="added-items-container" style="margin-top: 1rem;">
                  <h3 style="font-size: 1rem; font-weight: 600; color: #374151;">è¿½åŠ æ¸ˆã¿ãƒªã‚¹ãƒˆ</h3>
                  <div id="added-items-list" style="margin-top: 0.5rem; padding: 0.75rem; background-color: #f9fafb; border-radius: 0.375rem; border: 1px solid #e5e7eb; min-height: 50px;"></div>
              </div>
          </div>
          <button id="confirm-button" type="button" style="width: 100%; margin-top: 1.5rem; padding: 0.75rem 1rem; background-color: #2563eb; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;" disabled>å†…å®¹ã‚’ç¢ºèªã™ã‚‹</button>
          <button id="back-to-page1-btn" type="button" style="width: 100%; margin-top: 1rem; padding: 0.75rem 1rem; background-color: white; color: #374151; font-weight: 700; font-size: 1.125rem; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer;">æˆ»ã‚‹</button>
      </div>
      
      <div id="page3" style="display: none;">
          <div style="margin-top: 2rem;">
              <h2 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; margin: 0 0 1rem 0;">ç¢ºèªç”»é¢</h2>
              <div>
                  <div style="margin-bottom: 0.75rem;">
                      <p style="font-size: 0.875rem; font-weight: 500; color: #6b7280; margin: 0;">ç™»éŒ²è€…å</p>
                      <p id="confirm-registrant" style="font-size: 1.125rem; color: #1f2937; margin: 0.25rem 0 0 0;"></p>
                  </div>
                  <div style="margin-bottom: 0.75rem;">
                      <p style="font-size: 0.875rem; font-weight: 500; color: #6b7280; margin: 0;">æ—¥ä»˜</p>
                      <p id="confirm-date" style="font-size: 1.125rem; color: #1f2937; margin: 0.25rem 0 0 0;"></p>
                  </div>
                  <div>
                      <p id="confirm-mode-label" style="font-size: 0.875rem; font-weight: 500; color: #6b7280; margin: 0;"></p>
                      <div id="confirm-items-list" style="margin-top: 0.25rem; padding: 0.75rem; background-color: #f9fafb; border-radius: 0.375rem; border: 1px solid #e5e7eb;"></div>
                  </div>
              </div>
          </div>
          <button id="register-btn" style="width: 100%; margin-top: 2rem; padding: 0.75rem 1rem; background-color: #16a34a; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">ã“ã®å†…å®¹ã§ç™»éŒ²ã™ã‚‹</button>
          <button id="back-to-page2-btn" type="button" style="width: 100%; margin-top: 1rem; padding: 0.75rem 1rem; background-color: white; color: #374151; font-weight: 700; font-size: 1.125rem; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer;">ä¿®æ­£ã™ã‚‹</button>
      </div>
      
      <div id="pageRegister" style="display: none;">
          <fieldset id="pageRegister-fieldset" style="border: none; padding: 0; margin: 0;">
              <div style="margin-top: 2rem;">
                  <h2 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; margin: 0 0 1.25rem 0;">æ–°è¦ç‰©å“ ä»®ç™»éŒ²</h2>
                  <p style="font-size: 0.875rem; color: #4b5563; margin: 0 0 1.25rem 0;">ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸç‰©å“ã¯ã€ç®¡ç†è€…ãŒPCã®ã€Œç®¡ç†è€…ãƒšãƒ¼ã‚¸ã€ã§æ‰¿èªã™ã‚‹ã¾ã§ãƒã‚¹ã‚¿ãƒ¼ã«ã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚</p>

                  <div style="margin-bottom: 1.25rem;">
                    <button type="button" id="launch-ocr-btn" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1rem; background-color: #2563eb; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574v9.548c0 1.067.75 1.994 1.802 2.169a47.865 47.865 0 001.134.175 2.31 2.31 0 011.64 1.055l.822 1.594a2.083 2.083 0 003.487 0l.822-1.594a2.31 2.31 0 011.64-1.055 47.865 47.865 0 001.134-.175 2.31 2.31 0 011.802-2.17V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.594a2.083 2.083 0 00-3.487 0l-.822 1.594A2.31 2.31 0 016.827 6.175zM12 12.75a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" />
                      </svg>
                      <span>ãƒ©ãƒ™ãƒ«ã‚’æ’®å½± (OCR)</span>
                    </button>
                  </div>

                  <div style="margin-bottom: 1.25rem;">
                      <label for="reg-name" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">å“å</label>
                      <textarea id="reg-name" placeholder="å“åï¼ˆOCRã§èª­ã¿å–ã£ãŸå¾Œã€ç·¨é›†ã—ã¦ãã ã•ã„ï¼‰" rows="3" style="width: 100%;"></textarea>
                  </div>
                  <div>
                    <label for="reg-category" style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.25rem;">ã‚«ãƒ†ã‚´ãƒª (å¿…é ˆ)</label>
                    <select id="reg-category" style="width: 100%;">
                        <option value="" disabled selected>-- åˆ†é¡ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                        <option value="åŠ‡è–¬è–¬å“">A: åŠ‡è–¬è–¬å“</option>
                        <option value="æ™®é€šè–¬å“">B: æ™®é€šè–¬å“</option>
                        <option value="æ²»ç™‚ç”¨è³‡æ">C: æ²»ç™‚ç”¨è³‡æ</option>
                        <option value="ç¹æ®–ç”¨è³‡æ">D: ç¹æ®–ç”¨è³‡æ</option>
                        <option value="ç‚¹æ»´ç”¨è³‡æ">E: ç‚¹æ»´ç”¨è³‡æ</option>
                        <option value="é£¼æ–™æ·»åŠ ç‰©">F: é£¼æ–™æ·»åŠ ç‰©</option>
                        <option value="æ¶ˆè€—å“">G: æ¶ˆè€—å“</option>
                    </select>
                  </div>
              </div>
              <button id="register-temp-btn" style="width: 100%; margin-top: 2rem; padding: 0.75rem 1rem; background-color: #16a34a; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">ã“ã®å†…å®¹ã§ä»®ç™»éŒ²ã™ã‚‹</button>
              <button id="back-to-page1-from-reg" type="button" style="width: 100%; margin-top: 1rem; padding: 0.75rem 1rem; background-color: white; color: #374151; font-weight: 700; font-size: 1.125rem; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer;">æˆ»ã‚‹</button>
          </fieldset>
      </div>
      
      <div id="success-screen" style="display: none; text-align: center; padding: 2.5rem 0;">
          <svg style="width: 4rem; height: 4rem; color: #22c55e; margin: 0 auto 1rem auto;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h2 style="font-size: 1.5rem; font-weight: 700; color: #1f2937; margin: 0 0 0.5rem 0;">ç™»éŒ²å®Œäº†</h2>
          <p id="success-message" style="color: #4b5563; margin: 0 0 1.5rem 0;">ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚</p>
          <button id="new-entry-btn" style="width: 100%; max-width: 20rem; margin: 0 auto; display: block; padding: 0.75rem 1rem; background-color: #2563eb; color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.375rem; border: none; cursor: pointer;">æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹</button>
      </div>
    </div>
    
    <input type="file" id="ocr-camera-input" style="display: none;" accept="image/*" capture="environment">

    <script>
        "use strict";

        // --- â˜… å¤šè¨€èªå¯¾å¿œãƒ‡ãƒ¼ã‚¿ â˜… ---
        const TRANSLATIONS = {
            ja: {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
                loading: 'ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...',
                // ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«
                title_outbound: 'å‡ºåº«ç™»éŒ²ãƒ„ãƒ¼ãƒ«',
                title_inbound: 'å…¥åº«ç™»éŒ²ãƒ„ãƒ¼ãƒ«',
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
                step1: 'æƒ…å ±å…¥åŠ›',
                step2: 'å“ç›®ç™»éŒ²',
                step3: 'å†…å®¹ç¢ºèª',
                // Page 1
                label_registrant: 'æ‹…å½“è€…å',
                label_date: 'æ—¥ä»˜',
                btn_next: 'æ¬¡ã¸é€²ã‚€',
                btn_mode_outbound: 'å…¥åº«',
                btn_mode_inbound: 'å‡ºåº«',
                // Page 2
                legend_inbound: 'å…¥åº«æƒ…å ±',
                label_voucher_photo: 'ä¼ç¥¨å†™çœŸ (ä»»æ„)',
                btn_select_file: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ',
                btn_launch_camera: 'ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•',
                label_voucher_number: 'ä¼ç¥¨ç•ªå· (å†™çœŸé¸æŠå¾Œã«æœ‰åŠ¹åŒ–)',
                placeholder_voucher_number: 'ãƒ•ã‚¡ã‚¤ãƒ«åã«ãªã‚Šã¾ã™',
                legend_item_outbound: 'å‡ºåº«å“ç›®',
                legend_item_inbound: 'å…¥åº«å“ç›®',
                label_item_name: 'å“å',
                placeholder_item_search: 'å“åã‚’æ¤œç´¢...',
                placeholder_item_select: '-- å“åã‚’é¸æŠ --',
                label_quantity: 'å€‹æ•°',
                placeholder_quantity: 'å€‹æ•°',
                btn_add_item: 'å“ç›®ã‚’è¿½åŠ ',
                heading_added_items: 'è¿½åŠ æ¸ˆã¿ãƒªã‚¹ãƒˆ',
                btn_confirm: 'å†…å®¹ã‚’ç¢ºèªã™ã‚‹',
                btn_back: 'æˆ»ã‚‹',
                // Page 3
                heading_confirmation: 'ç¢ºèªç”»é¢',
                label_confirm_registrant: 'ç™»éŒ²è€…å',
                label_confirm_date: 'æ—¥ä»˜',
                label_confirm_mode_outbound: 'å‡ºåº«å“ç›®',
                label_confirm_mode_inbound: 'å…¥åº«å“ç›®',
                btn_register: 'ã“ã®å†…å®¹ã§ç™»éŒ²ã™ã‚‹',
                btn_edit: 'ä¿®æ­£ã™ã‚‹',
                // æˆåŠŸç”»é¢
                success_title: 'ç™»éŒ²å®Œäº†',
                success_message: 'ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚',
                btn_new_entry: 'æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹',
                // æ–°è¦ç‰©å“ç™»éŒ²
                temp_register_mode: 'æ–°è¦ç‰©å“ ä»®ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰',
                page_register_title: 'æ–°è¦ç‰©å“ ä»®ç™»éŒ²',
                page_register_desc: 'ã“ã“ã§ç™»éŒ²ã•ã‚ŒãŸç‰©å“ã¯ã€ç®¡ç†è€…ãŒPCã®ã€Œç®¡ç†è€…ãƒšãƒ¼ã‚¸ã€ã§æ‰¿èªã™ã‚‹ã¾ã§ãƒã‚¹ã‚¿ãƒ¼ã«ã¯åæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚',
                btn_launch_ocr: 'ãƒ©ãƒ™ãƒ«ã‚’æ’®å½± (OCR)',
                label_reg_name: 'å“å',
                placeholder_reg_name: 'å“åï¼ˆOCRã§èª­ã¿å–ã£ãŸå¾Œã€ç·¨é›†ã—ã¦ãã ã•ã„ï¼‰',
                label_reg_category: 'ã‚«ãƒ†ã‚´ãƒª (å¿…é ˆ)',
                placeholder_reg_category: '-- åˆ†é¡ã‚’é¸æŠã—ã¦ãã ã•ã„ --',
                btn_temp_register: 'ã“ã®å†…å®¹ã§ä»®ç™»éŒ²ã™ã‚‹'
            },
            en: {
                // Loading
                loading: 'Starting application...',
                // Main title
                title_outbound: 'Inventory Release Tool',
                title_inbound: 'Inventory Receipt Tool',
                // Progress bar
                step1: 'Info Input',
                step2: 'Items Entry',
                step3: 'Confirm',
                // Page 1
                label_registrant: 'Person in Charge',
                label_date: 'Date',
                btn_next: 'Next',
                btn_mode_outbound: 'Inbound',
                btn_mode_inbound: 'Outbound',
                // Page 2
                legend_inbound: 'Inbound Information',
                label_voucher_photo: 'Voucher Photo (Optional)',
                btn_select_file: 'Select File',
                btn_launch_camera: 'Launch Camera',
                label_voucher_number: 'Voucher Number (enabled after photo)',
                placeholder_voucher_number: 'Will be the filename',
                legend_item_outbound: 'Outbound Items',
                legend_item_inbound: 'Inbound Items',
                label_item_name: 'Item Name',
                placeholder_item_search: 'Search item name...',
                placeholder_item_select: '-- Select item --',
                label_quantity: 'Quantity',
                placeholder_quantity: 'Quantity',
                btn_add_item: 'Add Item',
                heading_added_items: 'Added List',
                btn_confirm: 'Confirm',
                btn_back: 'Back',
                // Page 3
                heading_confirmation: 'Confirmation',
                label_confirm_registrant: 'Registered By',
                label_confirm_date: 'Date',
                label_confirm_mode_outbound: 'Outbound Items',
                label_confirm_mode_inbound: 'Inbound Items',
                btn_register: 'Register',
                btn_edit: 'Edit',
                // Success screen
                success_title: 'Registration Complete',
                success_message: 'Data has been registered successfully.',
                btn_new_entry: 'Add New Record',
                // Temporary item registration
                temp_register_mode: 'New Item Temp Registration Mode',
                page_register_title: 'New Item Temporary Registration',
                page_register_desc: 'Items registered here will not be reflected in the master until approved by the administrator on the PC "Admin Page".',
                btn_launch_ocr: 'Capture Label (OCR)',
                label_reg_name: 'Item Name',
                placeholder_reg_name: 'Item name (edit after OCR scan)',
                label_reg_category: 'Category (Required)',
                placeholder_reg_category: '-- Select category --',
                btn_temp_register: 'Register Temporarily'
            },
            id: {
                // Loading
                loading: 'Memulai aplikasi...',
                // Main title
                title_outbound: 'Alat Pencatatan Pengeluaran',
                title_inbound: 'Alat Pencatatan Penerimaan',
                // Progress bar
                step1: 'Input Info',
                step2: 'Daftar Item',
                step3: 'Konfirmasi',
                // Page 1
                label_registrant: 'Penanggung Jawab',
                label_date: 'Tanggal',
                btn_next: 'Lanjut',
                btn_mode_outbound: 'Masuk',
                btn_mode_inbound: 'Keluar',
                // Page 2
                legend_inbound: 'Informasi Penerimaan',
                label_voucher_photo: 'Foto Dokumen (Opsional)',
                btn_select_file: 'Pilih File',
                btn_launch_camera: 'Buka Kamera',
                label_voucher_number: 'Nomor Dokumen (aktif setelah foto)',
                placeholder_voucher_number: 'Akan menjadi nama file',
                legend_item_outbound: 'Item Keluar',
                legend_item_inbound: 'Item Masuk',
                label_item_name: 'Nama Item',
                placeholder_item_search: 'Cari nama item...',
                placeholder_item_select: '-- Pilih item --',
                label_quantity: 'Jumlah',
                placeholder_quantity: 'Jumlah',
                btn_add_item: 'Tambah Item',
                heading_added_items: 'Daftar Ditambahkan',
                btn_confirm: 'Konfirmasi',
                btn_back: 'Kembali',
                // Page 3
                heading_confirmation: 'Konfirmasi',
                label_confirm_registrant: 'Didaftarkan Oleh',
                label_confirm_date: 'Tanggal',
                label_confirm_mode_outbound: 'Item Keluar',
                label_confirm_mode_inbound: 'Item Masuk',
                btn_register: 'Daftarkan',
                btn_edit: 'Edit',
                // Success screen
                success_title: 'Pendaftaran Selesai',
                success_message: 'Data telah berhasil didaftarkan.',
                btn_new_entry: 'Tambah Catatan Baru',
                // Temporary item registration
                temp_register_mode: 'Mode Pendaftaran Sementara Item Baru',
                page_register_title: 'Pendaftaran Sementara Item Baru',
                page_register_desc: 'Item yang didaftarkan di sini tidak akan tercermin dalam master sampai disetujui oleh administrator di "Halaman Admin" PC.',
                btn_launch_ocr: 'Tangkap Label (OCR)',
                label_reg_name: 'Nama Item',
                placeholder_reg_name: 'Nama item (edit setelah scan OCR)',
                label_reg_category: 'Kategori (Wajib)',
                placeholder_reg_category: '-- Pilih kategori --',
                btn_temp_register: 'Daftarkan Sementara'
            }
        };

        // ç¾åœ¨ã®è¨€èªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æ—¥æœ¬èªï¼‰
        let currentLang = localStorage.getItem('lang') || 'ja';

        // --- â˜… è¨€èªåˆ‡ã‚Šæ›¿ãˆé–¢æ•° â˜… ---
        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);

            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });

            // ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
            updateUILanguage();
        }

        // --- â˜… UIè¨€èªæ›´æ–°é–¢æ•° â˜… ---
        function updateUILanguage() {
            const t = TRANSLATIONS[currentLang];

            // è¨€èªãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åŒæœŸ
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === currentLang) {
                    btn.classList.add('active');
                }
            });

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
            const loadingText = document.getElementById('loading-status-text');
            if (loadingText) loadingText.textContent = t.loading;

            // ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ï¼‰
            const mainTitle = document.getElementById('main-title');
            if (mainTitle) {
                mainTitle.textContent = state.mode === 'outbound' ? t.title_outbound : t.title_inbound;
            }

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            const progressSteps = document.querySelectorAll('#progress-bar p.text-sm');
            if (progressSteps.length === 3) {
                progressSteps[0].textContent = t.step1;
                progressSteps[1].textContent = t.step2;
                progressSteps[2].textContent = t.step3;
            }

            // æ–°è¦ç‰©å“ä»®ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
            const registerProgressInfo = document.querySelector('#register-progress-info p');
            if (registerProgressInfo) registerProgressInfo.childNodes[2].textContent = t.temp_register_mode;

            // Page 1ãƒ©ãƒ™ãƒ«
            const labels = {
                'registrant-section label': t.label_registrant,
                'date-section label': t.label_date
            };
            Object.keys(labels).forEach(selector => {
                const elem = document.querySelector(`#${selector.replace(' label', '')} label`);
                if (elem) elem.textContent = labels[selector];
            });

            // Page 1ãƒœã‚¿ãƒ³
            const nextBtn = document.getElementById('next-btn');
            if (nextBtn) nextBtn.textContent = t.btn_next;

            const toggleModeBtn = document.getElementById('toggle-mode-button');
            if (toggleModeBtn) {
                toggleModeBtn.textContent = state.mode === 'outbound' ? t.btn_mode_outbound : t.btn_mode_inbound;
            }

            // Page 2
            const inboundFieldsLegend = document.querySelector('#inbound-fields legend');
            if (inboundFieldsLegend) inboundFieldsLegend.textContent = t.legend_inbound;

            const voucherPhotoLabel = document.querySelector('#photo-upload-section label');
            if (voucherPhotoLabel) voucherPhotoLabel.textContent = t.label_voucher_photo;

            const selectFileBtn = document.getElementById('select-file-btn');
            if (selectFileBtn) selectFileBtn.textContent = t.btn_select_file;

            const launchCameraBtn = document.getElementById('launch-camera-btn');
            if (launchCameraBtn) launchCameraBtn.textContent = t.btn_launch_camera;

            const voucherNumberLabel = document.querySelector('#voucher-number-input-group label');
            if (voucherNumberLabel) voucherNumberLabel.textContent = t.label_voucher_number;

            const voucherNumberInput = document.getElementById('voucher-number');
            if (voucherNumberInput) voucherNumberInput.placeholder = t.placeholder_voucher_number;

            const itemSectionLegend = document.getElementById('item-section-legend');
            if (itemSectionLegend) {
                itemSectionLegend.textContent = state.mode === 'outbound' ? t.legend_item_outbound : t.legend_item_inbound;
            }

            const itemNameLabel = document.querySelector('#item-add-section label[for="item-name"]');
            if (itemNameLabel) itemNameLabel.textContent = t.label_item_name;

            const itemSearchInput = document.getElementById('item-search');
            if (itemSearchInput) itemSearchInput.placeholder = t.placeholder_item_search;

            const itemNameSelect = document.getElementById('item-name');
            if (itemNameSelect && itemNameSelect.options.length > 0) {
                itemNameSelect.options[0].textContent = t.placeholder_item_select;
            }

            const quantityLabel = document.querySelector('#item-add-section label[for="quantity"]');
            if (quantityLabel) quantityLabel.textContent = t.label_quantity;

            const quantityInput = document.getElementById('quantity');
            if (quantityInput) quantityInput.placeholder = t.placeholder_quantity;

            const addItemBtn = document.getElementById('add-item-button');
            if (addItemBtn) addItemBtn.textContent = t.btn_add_item;

            const addedItemsHeading = document.querySelector('#added-items-container h3');
            if (addedItemsHeading) addedItemsHeading.textContent = t.heading_added_items;

            const confirmBtn = document.getElementById('confirm-button');
            if (confirmBtn) confirmBtn.textContent = t.btn_confirm;

            const backToPage1Btn = document.getElementById('back-to-page1-btn');
            if (backToPage1Btn) backToPage1Btn.textContent = t.btn_back;

            // Page 3
            const confirmationHeading = document.querySelector('#page3 h2');
            if (confirmationHeading) confirmationHeading.textContent = t.heading_confirmation;

            const confirmLabels = document.querySelectorAll('#page3 p.text-gray-500');
            if (confirmLabels.length >= 3) {
                confirmLabels[0].textContent = t.label_confirm_registrant;
                confirmLabels[1].textContent = t.label_confirm_date;
            }

            const confirmModeLabel = document.getElementById('confirm-mode-label');
            if (confirmModeLabel) {
                confirmModeLabel.textContent = state.mode === 'outbound' ? t.label_confirm_mode_outbound : t.label_confirm_mode_inbound;
            }

            const registerBtn = document.getElementById('register-btn');
            if (registerBtn) registerBtn.textContent = t.btn_register;

            const backToPage2Btn = document.getElementById('back-to-page2-btn');
            if (backToPage2Btn) backToPage2Btn.textContent = t.btn_edit;

            // æˆåŠŸç”»é¢
            const successTitle = document.querySelector('#success-screen h2');
            if (successTitle) successTitle.textContent = t.success_title;

            const successMessage = document.getElementById('success-message');
            if (successMessage) successMessage.textContent = t.success_message;

            const newEntryBtn = document.getElementById('new-entry-btn');
            if (newEntryBtn) newEntryBtn.textContent = t.btn_new_entry;

            // æ–°è¦ç‰©å“ç™»éŒ²ãƒšãƒ¼ã‚¸
            const pageRegisterHeading = document.querySelector('#pageRegister h2');
            if (pageRegisterHeading) pageRegisterHeading.textContent = t.page_register_title;

            const pageRegisterDesc = document.querySelector('#pageRegister p.text-sm');
            if (pageRegisterDesc) pageRegisterDesc.textContent = t.page_register_desc;

            const launchOcrBtn = document.getElementById('launch-ocr-btn');
            if (launchOcrBtn) {
                const span = launchOcrBtn.querySelector('span');
                if (span) span.textContent = t.btn_launch_ocr;
            }

            const regNameLabel = document.querySelector('label[for="reg-name"]');
            if (regNameLabel) regNameLabel.textContent = t.label_reg_name;

            const regNameTextarea = document.getElementById('reg-name');
            if (regNameTextarea) regNameTextarea.placeholder = t.placeholder_reg_name;

            const regCategoryLabel = document.querySelector('label[for="reg-category"]');
            if (regCategoryLabel) regCategoryLabel.textContent = t.label_reg_category;

            const regCategorySelect = document.getElementById('reg-category');
            if (regCategorySelect && regCategorySelect.options.length > 0) {
                regCategorySelect.options[0].textContent = t.placeholder_reg_category;
            }

            const registerTempBtn = document.getElementById('register-temp-btn');
            if (registerTempBtn) registerTempBtn.textContent = t.btn_temp_register;

            const backToPage1FromReg = document.getElementById('back-to-page1-from-reg');
            if (backToPage1FromReg) backToPage1FromReg.textContent = t.btn_back;
        }

        // --- â˜… èªè¨¼ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰åŸ‹ã‚è¾¼ã¿ãƒ»å®‰å…¨åŒ–ï¼‰ â˜… ---
        // ã‚µãƒ¼ãƒãƒ¼å´ã§æ–‡å­—åˆ—åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«å‡¦ç†
        const rawAuth = <?= typeof initialAuthData !== 'undefined' ? JSON.stringify(initialAuthData) : 'null' ?>;
        const AUTH_DATA = rawAuth ? ((typeof rawAuth === 'string') ? JSON.parse(rawAuth) : rawAuth) : null;

        // --- â˜… ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° (çŠ¶æ…‹ç®¡ç†) â˜… ---
        const state = {
            mode: 'outbound', 
            items: [],
            currentUser: null,
            file: null, 
            appData: null,
            originalUrl: null,
            updateInterval: null 
        };
        // --- â˜… DOMè¦ç´ ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ â˜… ---
        const $ = (id) => document.getElementById(id);
        const dom = {
            mainContent: $('main-content'), statusMessage: $('status-message'), successScreen: $('success-screen'),
            page1: $('page1'), page2: $('page2'), page3: $('page3'), mainTitle: $('main-title'),
            step1: $('step1-circle'), step2: $('step2-circle'), step3: $('step3-circle'),
            line1: $('progress-line1'), line2: $('progress-line2'),
            registrantSection: $('registrant-section'), registrantDisplay: $('registrant-display'), registrantSelect: $('registrant-select'),
            registrantDisplayContainer: $('registrant-display-container'), registrantNameHidden: $('registrant-name'),
            changeUserBtn: $('change-user-btn'), adminLink: $('admin-link-placeholder'),
            dateSection: $('date-section'), dateInput: $('date-input'), nextBtn: $('next-btn'),
            toggleModeBtn: $('toggle-mode-button'), inboundFields: $('inbound-fields'),
            photoSection: $('photo-upload-section'), selectFileBtn: $('select-file-btn'),
            launchCameraBtn: $('launch-camera-btn'),
            fileNameDisplay: $('file-name-display'),
            voucherFileInput: $('voucher-photo-file'), voucherCameraInput: $('voucher-photo-camera'),
            voucherNumberInputGroup: $('voucher-number-input-group'), voucherNumber: $('voucher-number'),
            itemAddSection: $('item-add-section'), itemSectionLegend: $('item-section-legend'),
            itemSearch: $('item-search'), itemName: $('item-name'), quantity: $('quantity'), addItemBtn: $('add-item-button'),
            addedItemsContainer: $('added-items-container'), addedItemsList: $('added-items-list'),
            confirmBtn: $('confirm-button'), backToPage1Btn: $('back-to-page1-btn'),
            confirmRegistrant: $('confirm-registrant'), confirmDate: $('confirm-date'),
            confirmModeLabel: $('confirm-mode-label'), confirmItemsList: $('confirm-items-list'),
            registerBtn: $('register-btn'), backToPage2Btn: $('back-to-page2-btn'),
            successMessage: $('success-message'), newEntryBtn: $('new-entry-btn'),
            pageRegister: $('pageRegister'),
            regName: $('reg-name'),
            regCategory: $('reg-category'),
            launchOcrBtn: $('launch-ocr-btn'),
            registerTempBtn: $('register-temp-btn'),
            backToPage1FromReg: $('back-to-page1-from-reg'),
            ocrCameraInput: $('ocr-camera-input'),
            loadingStatusText: $('loading-status-text') 
        };
    </script>

    <?!= HtmlService.createHtmlOutputFromFile('JavaScript_Api').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('JavaScript_UI').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('JavaScript_Main').getContent(); ?>
    
    <script>
        window.addEventListener('load', () => {
            console.log("All scripts loaded. Executing initialize()...");

            // ä¿å­˜ã•ã‚ŒãŸè¨€èªã‚’å¾©å…ƒ
            const savedLang = localStorage.getItem('lang') || 'ja';
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === savedLang) {
                    btn.classList.add('active');
                }
            });
            currentLang = savedLang;

            if (typeof initialize === 'function') {
                initialize();
                // åˆæœŸåŒ–å¾Œã«è¨€èªã‚’é©ç”¨
                setTimeout(() => {
                    updateUILanguage();
                }, 500);
            } else {
                console.error("Main.js is not loaded or initialize() is missing.");
            }
        });
    </script>
    
</body>
</html>
