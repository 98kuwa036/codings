# ==============================================
# Compiler Optimization (Zen 2 / Ryzen 3000 Series)
# ==============================================
# -march=native: 現在のCPU (Zen 2) に最適化された命令セットを使用
# -O2: 最も安全で高速な最適化レベル (-O3はバグの原因になることがあるためO2推奨)
# -pipe: ビルド中に一時ファイルを作らずメモリを使う（高速化）
COMMON_FLAGS="-O2 -march=native -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"

# ==============================================
# Parallel Build Settings (12 Cores / 24 Threads)
# ==============================================
# 基本はスレッド数と同じか+1。32GB RAMなら -j24 で問題なし。
MAKEOPTS="-j24"

# emerge自体の並列数。裏で複数のパッケージを同時にダウンロード・計算させる
EMERGE_DEFAULT_OPTS="--jobs=12 --load-average=24"

# ==============================================
# Hardware Specifics (Radeon RX 5700 XT)
# ==============================================
# amdgpu: カーネルドライバ
# radeonsi: Mesa OpenGLドライバ (必須)
VIDEO_CARDS="amdgpu radeonsi"

# CPUの拡張命令セット (Zen 2 用)
# ※あとで cpuid2cpuflags で正確な値を生成することを推奨しますが、
#   とりあえずZen 2の標準的なフラグを入れておきます。
CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3"

# ==============================================
# USE Flags (System Wide)
# ==============================================
# 足し算: Wayland, Qt6, KDE, 日本語入力, 動画再生支援, 音響
# 引き算: Systemd, GNOME, GTK(可能な限り), 古い技術
USE="amd64 smp \
     wayland vulkan vaapi gles2 \
     plasma qt6 qml \
     alsa pipewire sound-server screencast pulseaudio-compat \
     dbus elogind policykit udev \
     cjk nls unicode \
     zstd lz4 \
     usb wifi bluetooth \
     -systemd -gnome -gtk -gtk2 -gtk3 -eds -telepathy \
     -ipv6 -handbook -test -doc -debug \
     -consolekit -libav"

# ==============================================
# Localization & License
# ==============================================
# 日本語環境と英語環境
L10N="ja en en-US"
LINGUAS="ja en en-US"

# ファームウェアやSteam等のライセンスを全許可 (トラブル防止)
ACCEPT_LICENSE="*"

# ==============================================
# Directories
# ==============================================
# Ryzen 9 は速いのでメモリ上でビルドしなくても十分ですが、
# SSDの寿命を延ばしたい場合は tmpfs 設定を fstab で行いここを指定
# PORTAGE_TMPDIR="/var/tmp"
