# 在庫管理システム セットアップ手順

このガイドでは、在庫管理システムを最初から設定する手順を詳しく説明します。

## 目次

1. [事前準備](#事前準備)
2. [Excelブックの作成](#excelブックの作成)
3. [VBAモジュールのインポート](#vbaモジュールのインポート)
4. [システム初期化](#システム初期化)
5. [マスターデータ設定](#マスターデータ設定)
6. [動作確認](#動作確認)
7. [トラブルシューティング](#トラブルシューティング)

---

## 事前準備

### 必要な環境

- **Microsoft Excel**: 2016以降（Windows版推奨）
- **マクロ有効**: VBA機能が使用可能であること
- **ファイル**: VBAフォルダ内の9つの`.bas`ファイル

### ファイルの確認

以下の9ファイルがあることを確認してください：

```
VBA/
├── Main.bas
├── Utils.bas
├── MasterManagement.bas
├── InventoryOperations.bas
├── TransactionLog.bas
├── OrderManagement.bas
├── TrendAnalysis.bas
├── AlertDashboard.bas
└── CSVHandler.bas
```

---

## Excelブックの作成

### ステップ1: 新規ブックを作成

1. Microsoft Excelを起動
2. 「新しいブック」を作成
3. **重要**: すぐに「名前を付けて保存」

### ステップ2: マクロ有効ブックとして保存

1. `Ctrl + S`または「ファイル」→「名前を付けて保存」
2. **ファイル名**: `在庫管理システム.xlsm`
3. **ファイルの種類**: 「Excelマクロ有効ブック (*.xlsm)」を選択
4. 保存場所を選択して「保存」

### 重要ポイント

- `.xlsm`形式で保存しないとマクロが保存されません
- `.xlsx`形式はマクロが保存できません

---

## VBAモジュールのインポート

### ステップ1: VBAエディタを開く

1. `Alt + F11`を押す
2. または「開発」タブ→「Visual Basic」をクリック

**「開発」タブが表示されない場合**:
1. 「ファイル」→「オプション」→「リボンのユーザー設定」
2. 右側の「開発」にチェックを入れる
3. 「OK」をクリック

### ステップ2: プロジェクトを確認

VBAエディタの左側「プロジェクト エクスプローラー」に以下が表示されていることを確認：
```
VBAProject (在庫管理システム.xlsm)
```

### ステップ3: モジュールをインポート

**重要: 以下の手順を9回繰り返します（各`.bas`ファイルごと）**

1. プロジェクト エクスプローラーで`VBAProject (在庫管理システム.xlsm)`を右クリック
2. 「ファイルのインポート」を選択
3. ファイル選択ダイアログが表示される
4. 最初に`Utils.bas`を選択（推奨順序）
5. 「開く」をクリック
6. 次に他の`.bas`ファイルも同様にインポート

**推奨インポート順序**:
```
1. Utils.bas          （共通関数）
2. CSVHandler.bas     （CSV処理）
3. MasterManagement.bas
4. InventoryOperations.bas
5. TransactionLog.bas
6. OrderManagement.bas
7. TrendAnalysis.bas
8. AlertDashboard.bas
9. Main.bas           （最後）
```

### ステップ4: インポート確認

プロジェクト エクスプローラーに以下が表示されていることを確認：
```
VBAProject (在庫管理システム.xlsm)
├─ Microsoft Excel Objects
│  └─ Sheet1 (Sheet1)
└─ 標準モジュール
   ├─ Main
   ├─ Utils
   ├─ MasterManagement
   ├─ InventoryOperations
   ├─ TransactionLog
   ├─ OrderManagement
   ├─ TrendAnalysis
   ├─ AlertDashboard
   └─ CSVHandler
```

---

## システム初期化

### ステップ1: InitializeSystemを実行

**方法A: VBAエディタから実行**
1. VBAエディタで`Main`モジュールをダブルクリック
2. `InitializeSystem`プロシージャを見つける
3. カーソルを`InitializeSystem`内に置く
4. `F5`キーを押す（または「実行」→「Sub/ユーザーフォームの実行」）

**方法B: Excelから実行**
1. `Alt + F11`でExcelに戻る
2. 「開発」タブ→「マクロ」
3. `InitializeSystem`を選択
4. 「実行」をクリック

### ステップ2: 完了確認

以下のメッセージが表示されれば成功：
```
システムの初期化が完了しました。

「ホーム」シートから操作を開始してください。
```

### ステップ3: シートの確認

以下の8つのシートが自動作成されていることを確認：
```
- ホーム
- マスター設定
- 棚卸データ
- 入出庫履歴
- 在庫一覧
- 発注管理
- アラート
- 使用量トレンド
```

---

## マスターデータ設定

### 方法A: 既存の棚卸データがある場合

#### ステップ1: 棚卸CSVを準備

以下の形式でCSVファイルを作成：
```csv
日付,物品名,数量,単位
2025-01-15,炭酸水,38,本
2025-01-15,ティッシュ,8,箱
2025-01-15,コピー用紙,1500,枚
```

**重要**: 数量は**最小単位**で記入

#### ステップ2: CSVをインポート

1. 「ホーム」シートを開く
2. 「開発」タブ→「マクロ」
3. `Menu_ImportInventory`を実行
4. または、VBAエディタで`ImportInventoryCSV`を実行
5. CSVファイルを選択
6. 確認メッセージで「はい」

#### ステップ3: マスターを自動生成

1. 「ホーム」シートで「マクロ」
2. `Menu_GenerateMaster`を実行
3. または、VBAエディタで`GenerateMasterFromInventory`を実行
4. 確認メッセージで「はい」

#### ステップ4: マスター情報を編集

1. 「マスター設定」シートを開く
2. 各物品の以下の情報を手動で設定：
   - **C列（最小単位名）**: 本、個、枚など
   - **D列（荷姿単位名）**: ダース、ケース、束など
   - **E列（荷姿入数）**: 1荷姿あたりの個数
   - **F列（発注点）**: この数以下で発注アラート

**例**:
```
A001 | 炭酸水      | 本 | ダース | 12 | 24
A002 | ティッシュ  | 箱 | ケース | 5  | 10
A003 | コピー用紙  | 枚 | 束    | 500| 1000
```

### 方法B: ゼロから手動登録する場合

#### ステップ1: 物品を1つずつ追加

1. 「ホーム」シートで「マクロ」
2. `Menu_AddItem`を実行
3. または、VBAエディタで`AddNewItem`を実行

#### ステップ2: 入力フォームに従って入力

```
物品名: 炭酸水
最小単位名: 本
荷姿単位名: ダース
荷姿入数: 12
発注点: 24
```

各入力ダイアログに順番に入力していきます。

#### ステップ3: 全物品を登録

他の物品も同様に登録します。

#### ステップ4: 初期在庫を記録

1. 「マクロ」→`Menu_InputInventory`を実行
2. 物品名を入力
3. 荷姿数を入力
4. 端数を入力
5. 確認して登録

---

## 動作確認

### テスト1: 現在庫計算

1. 「マクロ」→`Menu_CalculateStock`を実行
2. 「マスター設定」シートのG列（現在庫）に数値が表示されることを確認

### テスト2: 在庫一覧表示

1. 「マクロ」→`Menu_ShowStock`を実行
2. 「在庫一覧」シートに物品が表示されることを確認
3. 現在庫が荷姿単位で表示されることを確認

### テスト3: アラート表示

1. 「マクロ」→`Menu_ShowAlerts`を実行
2. 「アラート」シートが表示される
3. 発注必要品目が表示される（発注点以下の場合）

### テスト4: 入出庫記録

1. 「マクロ」→`Menu_RecordOutbound`を実行
2. 適当な物品で出庫を記録
3. 「入出庫履歴」シートに記録されることを確認
4. 「現在庫計算」を再実行
5. 在庫が減っていることを確認

### テスト5: 発注リスト作成

1. 「マクロ」→`Menu_GenerateOrderList`を実行
2. 「発注管理」シートに発注必要品目が表示される
3. 推奨発注数が荷姿単位で表示されることを確認

---

## ボタンの追加（オプション）

ホームシートに実行ボタンを追加すると便利です。

### ボタンの作成方法

1. 「開発」タブ→「挿入」→「ボタン（フォームコントロール）」
2. ホームシート上でドラッグしてボタンを配置
3. 「マクロの登録」ダイアログが表示される
4. 実行したいマクロを選択（例: `Menu_ShowAlerts`）
5. 「OK」をクリック
6. ボタン上で右クリック→「テキストの編集」
7. ボタン名を変更（例: 「アラート確認」）

### 推奨ボタン配置

ホームシートに以下のボタンを配置すると便利：

```
[アラート確認]        Menu_ShowAlerts
[全データ更新]        Menu_RefreshAll
[在庫一覧]           Menu_ShowStock
[入庫記録]           Menu_RecordInbound
[出庫記録]           Menu_RecordOutbound
[棚卸入力]           Menu_InputInventory
[発注リスト作成]      Menu_GenerateOrderList
```

---

## トラブルシューティング

### 問題1: マクロが実行できない

**症状**: 「マクロが無効になっています」

**対処法**:
1. 「ファイル」→「オプション」→「セキュリティセンター」
2. 「セキュリティセンターの設定」をクリック
3. 「マクロの設定」を選択
4. 「警告を表示してすべてのマクロを無効にする」または「すべてのマクロを有効にする」を選択
5. Excelを再起動

### 問題2: モジュールがインポートできない

**症状**: 「ファイルのインポート」が選択できない

**対処法**:
1. VBAエディタでプロジェクト名を確認
2. プロジェクト名を右クリック（Sheetではない）
3. それでもダメな場合、Excelを再起動

### 問題3: InitializeSystemでエラーが出る

**症状**: 「コンパイルエラー」または「実行時エラー」

**対処法**:
1. すべての`.bas`ファイルがインポートされているか確認
2. VBAエディタで「デバッグ」→「VBAProjectのコンパイル」
3. エラー箇所を確認
4. 特定のモジュールが見つからない場合、再インポート

### 問題4: シートが作成されない

**症状**: InitializeSystem実行後もシートが1つのまま

**対処法**:
1. VBAエディタでエラーが出ていないか確認
2. Excelのシート数上限に達していないか確認
3. シート名が既に存在していないか確認

### 問題5: マクロ一覧に何も表示されない

**症状**: 「開発」→「マクロ」で一覧が空

**対処法**:
1. `.xlsm`形式で保存されているか確認
2. モジュールが正しくインポートされているか確認
3. VBAエディタでモジュール内に`Public Sub`があるか確認

---

## セットアップ後の推奨事項

### 1. バックアップを作成

初期設定が完了したら、Excelファイルをバックアップ：
```
在庫管理システム_初期設定完了_2025-01-15.xlsm
```

### 2. 操作マニュアルを確認

- `使い方ガイド.md`を読む
- `データ構造.md`でCSV形式を確認

### 3. テストデータで練習

本番データを入れる前に、テストデータで操作に慣れる：
1. 架空の物品を5個程度登録
2. 入出庫記録を試す
3. 発注リスト作成を試す
4. CSV出力を試す

### 4. 運用ルールを決める

- 誰が棚卸をするか
- いつ入出庫記録をするか
- どのタイミングで発注するか
- データバックアップのタイミング

---

## 完了チェックリスト

セットアップが完了したか、以下をチェックしてください：

- [ ] Excelブックを`.xlsm`形式で保存した
- [ ] 9つの`.bas`ファイルをすべてインポートした
- [ ] `InitializeSystem`を実行した
- [ ] 8つのシートが作成された
- [ ] マスターデータを設定した
- [ ] 現在庫計算が動作した
- [ ] 在庫一覧が表示された
- [ ] アラートが表示された
- [ ] 入出庫記録ができた
- [ ] 発注リストが作成できた
- [ ] バックアップを作成した

---

**すべて完了したら、日常運用を開始できます！**

詳しい使い方は「使い方ガイド.md」を参照してください。
