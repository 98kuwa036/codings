# 在庫管理システム 使い方ガイド

## 目次

1. [初回セットアップ](#初回セットアップ)
2. [日常運用](#日常運用)
3. [機能詳細](#機能詳細)
4. [単位の理解](#単位の理解)
5. [よくある質問](#よくある質問)

---

## 初回セットアップ

### ステップ1: VBAモジュールのインポート

1. 新しいExcelブックを作成
2. **マクロ有効ブック**として保存（`.xlsm`形式）
3. `Alt + F11`でVBAエディタを開く
4. 左側のプロジェクトエクスプローラーで、自分のブックを選択
5. メニューから「ファイル」→「ファイルのインポート」を選択
6. `VBA`フォルダ内の`.bas`ファイルを**すべて**インポート（9ファイル）

### ステップ2: システム初期化

1. VBAエディタで`Main`モジュールを開く
2. `InitializeSystem`プロシージャを実行（F5キー）
3. または、Excelの「開発」タブ→「マクロ」から`InitializeSystem`を実行
4. 完了メッセージが表示されたらOK

### ステップ3: データ設定

#### 方法A: 既存の棚卸データがある場合

1. 棚卸CSVを準備（形式: 日付, 物品名, 数量, 単位）
2. 「ホーム」シートで「📥 棚卸CSVインポート」を実行
3. CSVファイルを選択
4. 「🔧 マスター自動生成」を実行
5. 「マスター設定」シートを開き、以下を設定：
   - 最小単位名（例: 本、個、枚）
   - 荷姿単位名（例: ダース、ケース、箱）
   - 荷姿入数（1荷姿あたりの最小単位数）
   - 発注点（最小単位）

#### 方法B: ゼロから始める場合

1. 「➕ 物品追加」で物品を1つずつ登録
2. 各物品の情報を入力：
   - 物品名
   - 最小単位名
   - 荷姿単位名
   - 荷姿入数
   - 発注点
3. 「📋 棚卸入力」で初期在庫を記録

### ステップ4: 動作確認

1. 「🔄 全データ更新」を実行
2. 「📊 アラート確認」で正しく表示されるか確認
3. 「📦 在庫一覧」で在庫が表示されるか確認

---

## 日常運用

### 毎日の作業フロー

```
朝:
1. 「📊 アラート確認」で状況チェック

入出庫があったら:
2. 「➕ 入庫記録」または「➖ 出庫記録」

夕方:
3. 「🔄 全データ更新」で最新状態に

週1回:
4. 発注が必要なら「📝 発注リスト作成」→「📄 CSV出力」

月1回:
5. 「📈 使用量分析」で急増品目をチェック
6. 「💡 発注点見直し提案」で適切な発注点を確認
```

---

## 機能詳細

### 📊 アラート確認（最重要）

**目的**: 発注必要品目と使用急増品目を一目で確認

**使い方**:
1. 「ホーム」シート→「📊 アラート確認」をクリック
2. 自動的に全データが更新され、アラートシートが表示されます

**表示内容**:
- **発注必要品目**（上部）
  - 🔴緊急: 現在庫が発注点の50%未満
  - 🟠注意: 現在庫が発注点の75%未満
  - 🟡要確認: 現在庫が発注点以下
  - 推奨発注数が荷姿単位で表示されます

- **使用急増品目**（下部）
  - 🟡急増: 前月比150%以上、または3ヶ月平均の2倍以上
  - 増加率が%で表示されます

**対応方法**:
- 🔴緊急の品目はすぐに発注
- 🟡急増の品目は発注点の見直しを検討

### ➕➖ 入出庫記録

**目的**: 日々の入出庫を荷姿単位で簡単に記録

**使い方（荷姿入力版）**:
1. 「ホーム」シート→「➕ 入庫記録（荷姿）」または「➖ 出庫記録（荷姿）」
2. 物品名を入力（例: 炭酸水）
3. 荷姿数を入力（例: 3）※ダース数
4. 端数を入力（例: 2）※本数
5. 記録者名を入力
6. 確認画面で内容をチェック
7. OKで記録完了

**表示例**:
```
種別: 入庫
物品名: 炭酸水
荷姿: 3ダース
端数: 2本
合計: 38本
記録者: 田中

この内容で記録しますか？
```

**使い方（最小単位直接入力版）**:
端数のみの場合に便利です。
1. 「ホーム」シート→「📝 入出庫記録（最小単位）」
2. 種別を選択（1: 入庫、2: 出庫）
3. 物品名を入力
4. 数量を入力（最小単位）
5. 記録者名を入力
6. 確認して登録

### 📋 棚卸入力

**目的**: 定期的な棚卸を荷姿単位で記録

**使い方**:
1. 「ホーム」シート→「📋 棚卸入力」
2. 物品名を入力
3. 荷姿数を入力
4. 端数を入力
5. 確認して登録

**注意**:
- 棚卸データは最新のものが使われます
- CSVインポートすると既存の棚卸データは上書きされます

### 📝 発注リスト作成

**目的**: 発注が必要な品目を自動抽出

**使い方**:
1. 「ホーム」シート→「📝 発注リスト作成」
2. 発注点以下の品目が自動抽出されます
3. 推奨発注数が計算されます
4. 発注管理シートに結果が表示されます

**推奨発注数の計算**:
```
目標在庫 = 発注点 × 2
不足数 = 目標在庫 - 現在庫
荷姿数 = 切り上げ(不足数 ÷ 荷姿入数)
推奨発注数 = 荷姿数 × 荷姿入数
```

### 📄 発注CSV出力

**2種類のCSV出力**:

#### 1. 荷姿単位版（注文書用）
```csv
物品名,発注数,単位
炭酸水,3,ダース
ティッシュ,2,ケース
```
発注書として業者に送る際に使用

#### 2. 詳細版（データ管理用）
```csv
物品名,現在庫,単位,発注点,推奨発注数（荷姿）,推奨発注数（最小単位）,発注後在庫
炭酸水,20,本,24,3ダース,36,56
```
社内の記録・分析用

### ✅ 発注完了記録

**目的**: 発注した商品が届いたら入庫として記録

**使い方**:
1. 「ホーム」シート→「✅ 発注完了記録」
2. 物品名を入力
3. 発注数を入力（荷姿単位）
4. 確認して記録
5. 自動的に入出庫履歴に「入庫」として記録されます

### 📈 使用量分析

**目的**: 月次の使用量を分析し、急増を検知

**使い方**:
1. 「ホーム」シート→「📈 使用量分析」
2. 全物品の月次使用量が計算されます
3. 前月比、3ヶ月平均が表示されます
4. 急増品目が自動検知されます

**急増判定条件**:
- 前月比150%以上
- 3ヶ月平均の2倍以上

### 📊 グラフ作成

**目的**: 特定物品の使用量推移をグラフで可視化

**使い方**:
1. 「ホーム」シート→「📊 グラフ作成」
2. 物品名を入力
3. 過去6ヶ月の使用量推移グラフが自動生成されます
4. 発注点の水平線も表示されます

### 💡 発注点見直し提案

**目的**: 使用量トレンドに基づいて適切な発注点を提案

**使い方**:
1. 「ホーム」シート→「💡 発注点見直し提案」
2. 3ヶ月平均使用量の1.5倍を推奨発注点として提案
3. 現在の発注点と大きく異なる品目のみ表示されます

**提案例**:
```
【発注点見直し提案】

炭酸水:
  現在: 24本
  推奨: 45本
  (3ヶ月平均: 30本)
```

---

## 単位の理解

### 重要な概念

#### 最小単位
実際に数える最小の個数
- 例: 本、個、枚、袋

#### 荷姿単位
注文時の単位（最小単位の集合）
- 例: ダース、ケース、箱、束

#### 荷姿入数
1荷姿あたりの最小単位数
- 例: 1ダース = 12本

### 単位の使い分け

| 場面 | 使用する単位 | 理由 |
|------|-------------|------|
| **入力** | 荷姿+端数 | 人間が数えやすい |
| **画面表示** | 荷姿+端数 | 分かりやすい |
| **データ保存** | 最小単位 | 計算が正確 |
| **発注** | 荷姿単位 | 注文しやすい |

### 具体例

**例1: 炭酸水**
- 最小単位名: 本
- 荷姿単位名: ダース
- 荷姿入数: 12本/ダース

実在庫38本の場合の表示:
```
入力: 3ダース + 2本
表示: 3ダース+2本 (38本)
保存: 38（最小単位）
```

**例2: ティッシュ**
- 最小単位名: 箱
- 荷姿単位名: ケース
- 荷姿入数: 5箱/ケース

実在庫8箱の場合の表示:
```
入力: 1ケース + 3箱
表示: 1ケース+3箱 (8箱)
保存: 8（最小単位）
```

---

## よくある質問

### Q1: 現在庫がマイナスになってしまった
**A**: 以下を確認してください：
1. 棚卸データが正しいか（「棚卸データ」シート）
2. 入出庫の種別が正しいか（「入出庫履歴」シート）
3. 「🔢 現在庫計算」を再実行

### Q2: 発注リストに品目が表示されない
**A**: 以下を確認してください：
1. マスター設定で発注点が設定されているか
2. 現在庫が計算されているか（「🔢 現在庫計算」を実行）
3. 実際に在庫が発注点以下になっているか

### Q3: 使用量トレンドにデータが出ない
**A**: 以下を確認してください：
1. 入出庫履歴に「出庫」データがあるか
2. 出庫データの日付が正しいか
3. 「📈 使用量分析」を実行したか

### Q4: 荷姿入数を間違えて登録した
**A**:
1. 「✏️ 物品情報更新」を実行
2. 物品名を入力
3. 「3: 荷姿入数」を選択
4. 正しい値を入力

### Q5: 物品を削除したい
**A**:
1. 「🗑️ 物品削除」を実行
2. 物品名を入力
3. 確認して削除

### Q6: 棚卸CSVの形式がわからない
**A**: 以下の形式で作成してください：
```csv
日付,物品名,数量,単位
2025-01-15,炭酸水,38,本
2025-01-15,ティッシュ,8,箱
```
- ヘッダー行はあってもなくてもOK
- 数量は最小単位で記入

### Q7: エラーが出て動かない
**A**:
1. マクロが有効になっているか確認
2. すべての`.bas`ファイルがインポートされているか確認
3. `InitializeSystem`を再実行
4. Excelを再起動

### Q8: グラフが表示されない
**A**:
1. 物品名が正しいか確認（マスター設定に登録済みか）
2. 入出庫履歴に出庫データがあるか確認
3. 「使用量トレンド」シートに古いグラフがないか確認

---

## 運用のヒント

### 定期メンテナンス

**毎日**:
- 入出庫記録
- アラート確認

**週1回**:
- 全データ更新
- 発注リスト確認

**月1回**:
- 使用量分析
- 発注点見直し
- データバックアップ

### データバックアップ

定期的に以下をバックアップしてください：
1. Excelファイル全体（`.xlsm`）
2. CSV出力したデータ

推奨: 月次でバックアップフォルダに保存

### パフォーマンス向上

物品数が多い場合（100品目以上）：
1. 「画面更新の停止」が自動で行われますが、処理に時間がかかる場合があります
2. 使わない過去データは別ファイルにアーカイブ
3. 年次で入出庫履歴をCSV出力して、Excelからは削除

---

**ご質問や不明点があれば、README.mdやデータ構造.mdも参照してください。**
