# 在庫管理システム v2.0

Excel VBAベースの在庫管理システムです。荷姿単位での入力、最小単位でのデータ保存、発注必要品目と使用量急増の自動検知機能を搭載しています。

## 特徴

### 🎯 使いやすい単位管理
- **入力**: 荷姿単位 + 端数（例: 3ダース + 2本）
- **画面表示**: 荷姿単位 + 端数（分かりやすい）
- **データ保存**: 最小単位（計算が正確）

### 📊 重要機能
- **発注アラート**: 発注必要品目を自動検知・可視化
- **使用急増検知**: 前月比150%以上、3ヶ月平均の2倍以上を自動検知
- **トレンド分析**: 月次使用量推移のグラフ自動生成
- **発注点見直し提案**: 使用量から適切な発注点を提案

### 💾 データ管理
- CSV形式での長期保存（軽量・5年以上保存可能）
- 完全ローカル管理（データ機密性確保）
- 月次自動保存

## システム構成

### VBAモジュール（9ファイル）

| ファイル | 機能 |
|---------|------|
| `Main.bas` | メイン処理・メニュー管理 |
| `Utils.bas` | 共通関数・単位変換 |
| `MasterManagement.bas` | マスター管理 |
| `InventoryOperations.bas` | 棚卸処理・現在庫計算 |
| `TransactionLog.bas` | 入出庫記録 |
| `OrderManagement.bas` | 発注管理・判定 |
| `TrendAnalysis.bas` | 使用量トレンド分析 |
| `AlertDashboard.bas` | アラート表示・可視化 |
| `CSVHandler.bas` | CSV入出力 |

### Excelシート構成

| シート名 | 用途 |
|---------|------|
| ホーム | メインメニュー |
| マスター設定 | 物品情報・発注ルール |
| 棚卸データ | 棚卸記録 |
| 入出庫履歴 | 入出庫ログ |
| 在庫一覧 | 現在庫確認 |
| 発注管理 | 発注リスト |
| アラート | 発注必要・急増の可視化 |
| 使用量トレンド | 月次分析 |

## セットアップ

### 1. VBAモジュールのインポート

1. Excelで新しいブックを作成（`.xlsm`形式で保存）
2. `Alt + F11`でVBAエディタを開く
3. 各`.bas`ファイルを順番にインポート：
   - 「ファイル」→「ファイルのインポート」
   - `VBA`フォルダ内の9つの`.bas`ファイルを選択

### 2. システム初期化

VBAエディタまたはマクロダイアログから実行：
```vba
InitializeSystem
```

これにより必要なシートが自動作成されます。

### 3. 初回データ設定

#### 方法A: 棚卸CSVからインポート
1. 棚卸CSVを用意（形式: 日付, 物品名, 数量）
2. 「棚卸CSVインポート」を実行
3. 「マスター自動生成」を実行
4. マスター設定シートで単位・発注点を設定

#### 方法B: 手動登録
1. 「物品追加」で物品を登録
2. 「棚卸入力」で初期在庫を記録

## 使い方

### 📋 日常運用フロー

```
1. 入出庫があったら記録
   ↓
2. 定期的に「全データ更新」
   ↓
3. アラート確認
   ↓
4. 発注が必要なら発注リスト作成→CSV出力
   ↓
5. 発注品が届いたら「発注完了記録」
```

### 🎯 主要機能の使い方

#### アラート確認（最重要）
```
ホーム → 「📊 アラート確認」
```
- 発注必要品目を一覧表示（🔴緊急、🟠注意、🟡要確認）
- 使用量急増品目を一覧表示（🟡急増）
- ワンクリックで全データ更新

#### 入出庫記録
```
ホーム → 「➕ 入庫記録（荷姿）」または「➖ 出庫記録（荷姿）」
```
1. 物品名を入力
2. 荷姿数を入力（例: 3ダース）
3. 端数を入力（例: 2本）
4. 記録者名を入力
5. 確認して登録

#### 棚卸入力
```
ホーム → 「📋 棚卸入力」
```
1. 物品名を入力
2. 荷姿数を入力
3. 端数を入力
4. 確認して登録

#### 発注管理
```
ホーム → 「📝 発注リスト作成」
```
1. 発注必要品目を自動抽出
2. 推奨発注数を計算（荷姿単位）
3. 「📄 発注CSV出力（荷姿）」で注文書用CSV出力

#### 使用量分析
```
ホーム → 「📈 使用量分析」
```
- 月次使用量を集計
- 前月比・3ヶ月平均を計算
- 急増品目を自動検知

#### グラフ作成
```
ホーム → 「📊 グラフ作成」
```
- 物品名を入力
- 過去6ヶ月の使用量推移グラフを自動生成
- 発注点の水平線も表示

## 計算ロジック

### 現在庫計算
```
現在庫（最小単位） = 棚卸数量 + 入庫合計 - 出庫合計
```

### 推奨発注数計算
```
1. 目標在庫 = 発注点 × 2
2. 不足数 = 目標在庫 - 現在庫
3. 荷姿数 = 切り上げ(不足数 ÷ 荷姿入数)
4. 推奨発注数 = 荷姿数 × 荷姿入数（最小単位）
```

### 使用急増判定
以下のいずれかに該当する場合「急増」と判定：
- 前月比150%以上
- 3ヶ月平均の2倍以上

## CSV形式

### マスターCSV
```csv
管理番号,物品名,最小単位名,荷姿単位名,荷姿入数,発注点（最小単位）
A001,炭酸水,本,ダース,12,24
A002,ティッシュ,箱,ケース,5,10
```

### 棚卸CSV
```csv
日付,物品名,数量,単位
2025-01-15,炭酸水,38,本
2025-01-15,ティッシュ,8,箱
```

### 入出庫CSV
```csv
日時,種別,物品名,数量,単位,記録者
2025-01-15 10:30,入庫,炭酸水,24,本,田中
2025-01-15 14:15,出庫,炭酸水,5,本,佐藤
```

## トラブルシューティング

### Q: 現在庫がマイナスになる
A: 以下を確認してください：
- 棚卸データが正しく入力されているか
- 入出庫の種別（入庫/出庫）が正しいか
- 「現在庫計算」を再実行

### Q: 発注リストが空
A: 以下を確認してください：
- マスター設定で発注点が設定されているか
- 「現在庫計算」を実行したか
- 実際に在庫が発注点以下になっているか

### Q: 使用量トレンドにデータが表示されない
A: 以下を確認してください：
- 入出庫履歴に「出庫」データがあるか
- 「使用量分析」を実行したか

## 注意事項

- マクロを有効にしてExcelを開いてください
- CSVファイルはUTF-8またはShift-JISで保存してください
- 定期的にバックアップを取ってください
- 棚卸データをインポートすると既存データは上書きされます
- 入出庫履歴は追記されます

## 開発情報

- **Version**: 2.0
- **作成日**: 2025-11-27
- **動作環境**: Microsoft Excel 2016以降（VBA対応版）
- **ライセンス**: MIT License

## 今後の拡張案

- [ ] 棚卸日以降の入出庫のみ計算する機能
- [ ] 複数倉庫対応
- [ ] 発注履歴のトラッキング
- [ ] 使用量予測に基づく発注点自動調整
- [ ] バーコード/QRコード連携
- [ ] クラウドバックアップ機能

## サポート

問題が発生した場合は、以下を確認してください：
1. 使い方ガイド.md
2. データ構造.md
3. セットアップ手順.md

---

**作成者**: Claude Code
**最終更新**: 2025-11-27
