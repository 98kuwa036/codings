Attribute VB_Name = "Main"
'===============================================================================
' åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
' Version: 2.0
' ä½œæˆæ—¥: 2025-11-27
'
' ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦:
' - è·å§¿å˜ä½+ç«¯æ•°ã§ã®å…¥åŠ›
' - æœ€å°å˜ä½ã§ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜
' - ç™ºæ³¨å¿…è¦å“ç›®ã®å¯è¦–åŒ–
' - ä½¿ç”¨é‡æ€¥å¢—ã®è‡ªå‹•æ¤œçŸ¥
'===============================================================================

Option Explicit

'===============================================================================
' ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
'===============================================================================

'-------------------------------------------------------------------------------
' ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’åˆæœŸåŒ–
'-------------------------------------------------------------------------------
Public Sub InitializeSystem()
    On Error GoTo ErrorHandler

    Application.ScreenUpdating = False

    ' å¿…è¦ãªã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
    CreateSheetIfNotExists HOME_SHEET
    CreateSheetIfNotExists MASTER_SHEET
    CreateSheetIfNotExists INVENTORY_SHEET
    CreateSheetIfNotExists TRANSACTION_SHEET
    CreateSheetIfNotExists ORDER_SHEET
    CreateSheetIfNotExists ALERT_SHEET
    CreateSheetIfNotExists TREND_SHEET
    CreateSheetIfNotExists STOCK_VIEW_SHEET

    ' å„ã‚·ãƒ¼ãƒˆã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    SetupHomeSheet
    SetupMasterSheet
    SetupInventorySheet
    SetupTransactionSheet
    SetupOrderSheet
    SetupAlertSheet
    SetupTrendSheet
    SetupStockViewSheet

    Application.ScreenUpdating = True

    ShowSuccessMessage "ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚" & vbCrLf & vbCrLf & _
                       "ã€Œãƒ›ãƒ¼ãƒ ã€ã‚·ãƒ¼ãƒˆã‹ã‚‰æ“ä½œã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚"
    Exit Sub

ErrorHandler:
    Application.ScreenUpdating = True
    ShowErrorMessage "åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: " & Err.Description
End Sub

'-------------------------------------------------------------------------------
' ã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ä½œæˆ
'-------------------------------------------------------------------------------
Private Sub CreateSheetIfNotExists(sheetName As String)
    Dim ws As Worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets(sheetName)
    On Error GoTo 0

    If ws Is Nothing Then
        Set ws = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
        ws.Name = sheetName
    End If
End Sub

'===============================================================================
' ãƒ›ãƒ¼ãƒ ã‚·ãƒ¼ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
'===============================================================================

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ã‚·ãƒ¼ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
'-------------------------------------------------------------------------------
Private Sub SetupHomeSheet()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets(HOME_SHEET)

    ws.Cells.Clear

    ' ã‚¿ã‚¤ãƒˆãƒ«
    With ws.Range("A1:F1")
        .Merge
        .Value = "åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v2.0"
        .Font.Size = 20
        .Font.Bold = True
        .HorizontalAlignment = xlCenter
        .Interior.Color = RGB(100, 150, 200)
        .Font.Color = RGB(255, 255, 255)
    End With

    ' èª¬æ˜
    With ws.Range("A2:F2")
        .Merge
        .Value = "è·å§¿å˜ä½ã§ã®å…¥åŠ›ã€æœ€å°å˜ä½ã§ã®ä¿å­˜ã€ç™ºæ³¨ãƒ»ä½¿ç”¨é‡æ€¥å¢—ã®è‡ªå‹•æ¤œçŸ¥"
        .HorizontalAlignment = xlCenter
        .Font.Size = 10
    End With

    ' ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³èª¬æ˜ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã€ãƒœã‚¿ãƒ³ã¯æ‰‹å‹•è¿½åŠ ï¼‰
    Dim row As Integer
    row = 4

    ws.Cells(row, 1).Value = "ã€æœ€é‡è¦ã€‘"
    ws.Cells(row, 2).Value = "ğŸ“Š ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª"
    ws.Cells(row, 3).Value = "ç™ºæ³¨å¿…è¦ãƒ»ä½¿ç”¨æ€¥å¢—ã‚’ãƒã‚§ãƒƒã‚¯"
    ws.Range("A" & row & ":C" & row).Interior.Color = RGB(255, 200, 200)
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ”„ å…¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°"
    ws.Cells(row, 3).Value = "ç¾åœ¨åº«ãƒ»ç™ºæ³¨ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ä¸€æ‹¬æ›´æ–°"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€åœ¨åº«ç¢ºèªã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“¦ åœ¨åº«ä¸€è¦§"
    ws.Cells(row, 3).Value = "å…¨ç‰©å“ã®åœ¨åº«çŠ¶æ³ã‚’ç¢ºèª"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ”¢ ç¾åœ¨åº«è¨ˆç®—"
    ws.Cells(row, 3).Value = "æ£šå¸ãƒ»å…¥å‡ºåº«ã‹ã‚‰ç¾åœ¨åº«ã‚’å†è¨ˆç®—"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€å…¥å‡ºåº«æ“ä½œã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "â• å…¥åº«è¨˜éŒ²ï¼ˆè·å§¿ï¼‰"
    ws.Cells(row, 3).Value = "è·å§¿+ç«¯æ•°ã§å…¥åº«ã‚’è¨˜éŒ²"
    row = row + 1

    ws.Cells(row, 2).Value = "â– å‡ºåº«è¨˜éŒ²ï¼ˆè·å§¿ï¼‰"
    ws.Cells(row, 3).Value = "è·å§¿+ç«¯æ•°ã§å‡ºåº«ã‚’è¨˜éŒ²"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“ å…¥å‡ºåº«è¨˜éŒ²ï¼ˆæœ€å°å˜ä½ï¼‰"
    ws.Cells(row, 3).Value = "ç«¯æ•°ã®ã¿è¨˜éŒ²ã™ã‚‹å ´åˆã«ä¾¿åˆ©"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€æ£šå¸ã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“‹ æ£šå¸å…¥åŠ›"
    ws.Cells(row, 3).Value = "è·å§¿+ç«¯æ•°ã§æ£šå¸ã‚’è¨˜éŒ²"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“¥ æ£šå¸CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ"
    ws.Cells(row, 3).Value = "æ£šå¸ãƒ‡ãƒ¼ã‚¿ã‚’CSVã‹ã‚‰èª­ã¿è¾¼ã¿"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€ç™ºæ³¨ç®¡ç†ã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“ ç™ºæ³¨ãƒªã‚¹ãƒˆä½œæˆ"
    ws.Cells(row, 3).Value = "ç™ºæ³¨å¿…è¦å“ç›®ã‚’ãƒªã‚¹ãƒˆåŒ–"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“„ ç™ºæ³¨CSVå‡ºåŠ›ï¼ˆè·å§¿ï¼‰"
    ws.Cells(row, 3).Value = "ç™ºæ³¨æ›¸ç”¨ã®CSVå‡ºåŠ›"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“„ ç™ºæ³¨CSVå‡ºåŠ›ï¼ˆè©³ç´°ï¼‰"
    ws.Cells(row, 3).Value = "ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨ã®è©³ç´°CSVå‡ºåŠ›"
    row = row + 1

    ws.Cells(row, 2).Value = "âœ… ç™ºæ³¨å®Œäº†è¨˜éŒ²"
    ws.Cells(row, 3).Value = "ç™ºæ³¨å“ãŒå±Šã„ãŸã‚‰è¨˜éŒ²"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€åˆ†æã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“ˆ ä½¿ç”¨é‡åˆ†æ"
    ws.Cells(row, 3).Value = "æœˆæ¬¡ä½¿ç”¨é‡ãƒ»æ€¥å¢—ã‚’åˆ†æ"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ“Š ã‚°ãƒ©ãƒ•ä½œæˆ"
    ws.Cells(row, 3).Value = "ä½¿ç”¨é‡æ¨ç§»ã‚°ãƒ©ãƒ•ã‚’è‡ªå‹•ç”Ÿæˆ"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ’¡ ç™ºæ³¨ç‚¹è¦‹ç›´ã—ææ¡ˆ"
    ws.Cells(row, 3).Value = "ä½¿ç”¨é‡ã‹ã‚‰ç™ºæ³¨ç‚¹ã‚’ææ¡ˆ"
    row = row + 1

    ws.Cells(row, 1).Value = "ã€ãƒã‚¹ã‚¿ãƒ¼ç®¡ç†ã€‘"
    row = row + 1

    ws.Cells(row, 2).Value = "â• ç‰©å“è¿½åŠ "
    ws.Cells(row, 3).Value = "æ–°ã—ã„ç‰©å“ã‚’ãƒã‚¹ã‚¿ãƒ¼ã«è¿½åŠ "
    row = row + 1

    ws.Cells(row, 2).Value = "âœï¸ ç‰©å“æƒ…å ±æ›´æ–°"
    ws.Cells(row, 3).Value = "å˜ä½ãƒ»ç™ºæ³¨ç‚¹ç­‰ã‚’å¤‰æ›´"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ—‘ï¸ ç‰©å“å‰Šé™¤"
    ws.Cells(row, 3).Value = "ç‰©å“ã‚’ãƒã‚¹ã‚¿ãƒ¼ã‹ã‚‰å‰Šé™¤"
    row = row + 1

    ws.Cells(row, 2).Value = "ğŸ”§ ãƒã‚¹ã‚¿ãƒ¼è‡ªå‹•ç”Ÿæˆ"
    ws.Cells(row, 3).Value = "æ£šå¸ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç‰©å“ã‚’ç™»éŒ²"
    row = row + 1

    ' åˆ—å¹…èª¿æ•´
    ws.Columns("A:A").ColumnWidth = 12
    ws.Columns("B:B").ColumnWidth = 25
    ws.Columns("C:C").ColumnWidth = 35

    ' ä½¿ã„æ–¹ãƒ¡ãƒ¢
    ws.Cells(row + 2, 1).Value = "ã€åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã€‘"
    ws.Cells(row + 2, 1).Font.Bold = True
    ws.Cells(row + 3, 1).Value = "1. æ£šå¸CSVã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã¾ãŸã¯ æ£šå¸å…¥åŠ›"
    ws.Cells(row + 4, 1).Value = "2. ãƒã‚¹ã‚¿ãƒ¼è‡ªå‹•ç”Ÿæˆï¼ˆã¾ãŸã¯æ‰‹å‹•ã§ç‰©å“è¿½åŠ ï¼‰"
    ws.Cells(row + 5, 1).Value = "3. ãƒã‚¹ã‚¿ãƒ¼è¨­å®šã‚·ãƒ¼ãƒˆã§ç™ºæ³¨ç‚¹ãƒ»å˜ä½ã‚’è¨­å®š"
    ws.Cells(row + 6, 1).Value = "4. ç¾åœ¨åº«è¨ˆç®—ã‚’å®Ÿè¡Œ"
    ws.Cells(row + 7, 1).Value = "5. ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèªã§çŠ¶æ³ãƒã‚§ãƒƒã‚¯"

    ws.Cells(row + 9, 1).Value = "ã€æ—¥å¸¸é‹ç”¨ã€‘"
    ws.Cells(row + 9, 1).Font.Bold = True
    ws.Cells(row + 10, 1).Value = "1. å…¥å‡ºåº«è¨˜éŒ²ã§æ—¥ã€…ã®å…¥å‡ºåº«ã‚’è¨˜éŒ²"
    ws.Cells(row + 11, 1).Value = "2. å®šæœŸçš„ã«ã€Œå…¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã€ã‚’å®Ÿè¡Œ"
    ws.Cells(row + 12, 1).Value = "3. ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèªã§ç™ºæ³¨å¿…è¦ãƒ»æ€¥å¢—ã‚’ãƒã‚§ãƒƒã‚¯"
    ws.Cells(row + 13, 1).Value = "4. ç™ºæ³¨ãƒªã‚¹ãƒˆä½œæˆâ†’CSVå‡ºåŠ›â†’ç™ºæ³¨"
    ws.Cells(row + 14, 1).Value = "5. ç™ºæ³¨å“ãŒå±Šã„ãŸã‚‰ã€Œç™ºæ³¨å®Œäº†è¨˜éŒ²ã€"
End Sub

'===============================================================================
' ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹é–¢æ•°ï¼ˆãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
'===============================================================================

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª
'-------------------------------------------------------------------------------
Public Sub Menu_ShowAlerts()
    ThisWorkbook.Sheets(ALERT_SHEET).Activate
    Call RefreshAll
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: å…¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°
'-------------------------------------------------------------------------------
Public Sub Menu_RefreshAll()
    Call RefreshAll
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: åœ¨åº«ä¸€è¦§
'-------------------------------------------------------------------------------
Public Sub Menu_ShowStock()
    Call UpdateStockView
    ThisWorkbook.Sheets(STOCK_VIEW_SHEET).Activate
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç¾åœ¨åº«è¨ˆç®—
'-------------------------------------------------------------------------------
Public Sub Menu_CalculateStock()
    Call CalculateAllCurrentStock
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: å…¥åº«è¨˜éŒ²
'-------------------------------------------------------------------------------
Public Sub Menu_RecordInbound()
    Call RecordInbound
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: å‡ºåº«è¨˜éŒ²
'-------------------------------------------------------------------------------
Public Sub Menu_RecordOutbound()
    Call RecordOutbound
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: å…¥å‡ºåº«è¨˜éŒ²ï¼ˆæœ€å°å˜ä½ï¼‰
'-------------------------------------------------------------------------------
Public Sub Menu_RecordTransactionDirect()
    Call RecordTransactionDirect
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: æ£šå¸å…¥åŠ›
'-------------------------------------------------------------------------------
Public Sub Menu_InputInventory()
    Call InputInventory
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: æ£šå¸CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
'-------------------------------------------------------------------------------
Public Sub Menu_ImportInventory()
    Call ImportInventoryCSV
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç™ºæ³¨ãƒªã‚¹ãƒˆä½œæˆ
'-------------------------------------------------------------------------------
Public Sub Menu_GenerateOrderList()
    Call GenerateOrderList
    ThisWorkbook.Sheets(ORDER_SHEET).Activate
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç™ºæ³¨CSVå‡ºåŠ›ï¼ˆè·å§¿ï¼‰
'-------------------------------------------------------------------------------
Public Sub Menu_ExportOrderPackage()
    Call ExportOrderListPackage
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç™ºæ³¨CSVå‡ºåŠ›ï¼ˆè©³ç´°ï¼‰
'-------------------------------------------------------------------------------
Public Sub Menu_ExportOrderDetail()
    Call ExportOrderListDetail
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç™ºæ³¨å®Œäº†è¨˜éŒ²
'-------------------------------------------------------------------------------
Public Sub Menu_RecordOrderComplete()
    Call RecordOrderComplete
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ä½¿ç”¨é‡åˆ†æ
'-------------------------------------------------------------------------------
Public Sub Menu_AnalyzeTrend()
    Call AnalyzeMonthlyUsage
    ThisWorkbook.Sheets(TREND_SHEET).Activate
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ã‚°ãƒ©ãƒ•ä½œæˆ
'-------------------------------------------------------------------------------
Public Sub Menu_CreateChart()
    Call CreateUsageTrendChart
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç™ºæ³¨ç‚¹è¦‹ç›´ã—ææ¡ˆ
'-------------------------------------------------------------------------------
Public Sub Menu_SuggestReorderPoint()
    Call SuggestReorderPointAdjustment
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç‰©å“è¿½åŠ 
'-------------------------------------------------------------------------------
Public Sub Menu_AddItem()
    Call AddNewItem
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç‰©å“æƒ…å ±æ›´æ–°
'-------------------------------------------------------------------------------
Public Sub Menu_UpdateItem()
    Call UpdateItemInfo
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ç‰©å“å‰Šé™¤
'-------------------------------------------------------------------------------
Public Sub Menu_DeleteItem()
    Call DeleteItem
End Sub

'-------------------------------------------------------------------------------
' ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³: ãƒã‚¹ã‚¿ãƒ¼è‡ªå‹•ç”Ÿæˆ
'-------------------------------------------------------------------------------
Public Sub Menu_GenerateMaster()
    Call GenerateMasterFromInventory
End Sub
